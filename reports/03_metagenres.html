<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Markus Radke">
<meta name="dcterms.date" content="2025-11-04">

<title>Metagenres - Genre Discourse Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="03_metagenres_files/libs/clipboard/clipboard.min.js"></script>
<script src="03_metagenres_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="03_metagenres_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="03_metagenres_files/libs/quarto-html/popper.min.js"></script>
<script src="03_metagenres_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03_metagenres_files/libs/quarto-html/anchor.min.js"></script>
<link href="03_metagenres_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03_metagenres_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="03_metagenres_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03_metagenres_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03_metagenres_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="03_metagenres_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="03_metagenres_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="03_metagenres_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="03_metagenres_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="03_metagenres_files/libs/r2d3-render-0.1.0/r2d3-render.js"></script>

<script src="03_metagenres_files/libs/webcomponents-2.0.0/webcomponents.js"></script>

<script src="03_metagenres_files/libs/r2d3-binding-0.2.6/r2d3.js"></script>

<script src="03_metagenres_files/libs/d3v6-6.2.0/d3.min.js"></script>



<link rel="stylesheet" href="styles.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="5">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#algorithm-for-folding-the-genre-tree-to-get-metagenres" id="toc-algorithm-for-folding-the-genre-tree-to-get-metagenres" class="nav-link active" data-scroll-target="#algorithm-for-folding-the-genre-tree-to-get-metagenres"><span class="header-section-number">1</span> Algorithm for folding the genre tree to get metagenres</a></li>
  <li><a href="#tuning-results" id="toc-tuning-results" class="nav-link" data-scroll-target="#tuning-results"><span class="header-section-number">2</span> Tuning results</a>
  <ul>
  <li><a href="#musicbrainz-metagenres" id="toc-musicbrainz-metagenres" class="nav-link" data-scroll-target="#musicbrainz-metagenres"><span class="header-section-number">2.1</span> MusicBrainz Metagenres</a></li>
  <li><a href="#spotify-metagenres" id="toc-spotify-metagenres" class="nav-link" data-scroll-target="#spotify-metagenres"><span class="header-section-number">2.2</span> Spotify Metagenres</a></li>
  </ul></li>
  <li><a href="#metagenre-assignment" id="toc-metagenre-assignment" class="nav-link" data-scroll-target="#metagenre-assignment"><span class="header-section-number">3</span> Metagenre assignment</a>
  <ul>
  <li><a href="#musicbrainz-metagenre-assignment" id="toc-musicbrainz-metagenre-assignment" class="nav-link" data-scroll-target="#musicbrainz-metagenre-assignment"><span class="header-section-number">3.1</span> MusicBrainz Metagenre Assignment</a>
  <ul>
  <li><a href="#musicbrainz-10-metagenres" id="toc-musicbrainz-10-metagenres" class="nav-link" data-scroll-target="#musicbrainz-10-metagenres"><span class="header-section-number">3.1.1</span> MusicBrainz 10 Metagenres</a></li>
  <li><a href="#musicbrainz-29-metagenres" id="toc-musicbrainz-29-metagenres" class="nav-link" data-scroll-target="#musicbrainz-29-metagenres"><span class="header-section-number">3.1.2</span> MusicBrainz 29 Metagenres</a></li>
  </ul></li>
  <li><a href="#spotify-metagenre-assignment" id="toc-spotify-metagenre-assignment" class="nav-link" data-scroll-target="#spotify-metagenre-assignment"><span class="header-section-number">3.2</span> Spotify Metagenre Assignment</a>
  <ul>
  <li><a href="#spotify-15-metagenres" id="toc-spotify-15-metagenres" class="nav-link" data-scroll-target="#spotify-15-metagenres"><span class="header-section-number">3.2.1</span> Spotify 15 Metagenres</a></li>
  <li><a href="#spotify-25-metagenres" id="toc-spotify-25-metagenres" class="nav-link" data-scroll-target="#spotify-25-metagenres"><span class="header-section-number">3.2.2</span> Spotify 25 Metagenres</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/markusradke/GenreDiscourseAnalysis"><i class="bi bi-link-45deg"></i>Github Repository</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Metagenres - Genre Discourse Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Markus Radke </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 4, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="algorithm-for-folding-the-genre-tree-to-get-metagenres" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Algorithm for folding the genre tree to get metagenres</h1>
<p>For answering research questions that involve genre comparision, often times the available genre labels are too specific and sparse to allow for meaningful analysis. To counter this, we can group genres into broader “metagenres” by folding our genre hierarchy tree. From a pragmatic perspective, we want to ensure that: 1. Each metagenre has a minimum number of songs associated with it to allow for statistical analysis. The only exception to this is the root of the tree, “POPULAR MUSIC”, which serves as a catch-all for songs that do not fit into any other metagenre. 2. Also, for machine learning applications, having a balanced distribution of songs across metagenres is beneficial. Therefore, we look for a tree of metagenres that maximizes the uniformity of song distribution across metagenres at each hierarchy level.</p>
<p>To achieve this, we implement a greedy algorithm that iteratively merges the least populous genres that are furthest from the root with their parent genres until all genres meet the minimum song count requirement. We evaluate different minimum song counts using a grid search approach to find the optimal configuration that maximizes distribution uniformity within hierarchy levels, measured by the weighted within-level Gini coefficient. Please refer to the flowchart below for a detailed overview of the algorithm.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {
  'flowchart': {
    'nodeSpacing': 50, 
    'rankSpacing': 80,
    'useMaxWidth': true,
    'htmlLabels': false,
    'curve': 'basis'
  }, 
  'theme': 'base',
  'themeVariables': {
    'fontSize': '22px',
    'fontFamily': 'Arial, sans-serif',
    'primaryColor': '#ffffff',
    'primaryTextColor': '#333333',
    'primaryBorderColor': '#cccccc', 
    'lineColor': '#666666',
    'textColor': '#333333'
  }
}}%%
flowchart TD
    A["Start with initial music genres and hierarchy tree"] --&gt; B["Try different minimum song counts (grid search)"]
    B --&gt; C["For each minimum count: Start folding process"]
    C --&gt; D["Find leaf genre with most songs at deepest level"]
    D --&gt; E{"Does this genre have enough songs?"}
    E --&gt;|Yes| F{"Is the parent genre the root of the tree?"}
    E --&gt;|No| G["Merge genre with parent and all siblings and all grandchildren of parent that were already metagenres"]
    F --&gt;|No| FF{"Would parent + siblings have enough songs combined?"}
    FF --&gt; |Yes| H["Pluck genre from tree (cut connection to parent)"]
    FF --&gt;|No| G
    F --&gt;|Yes| H
    G --&gt; I["Update song counts and mark genres as processed"]
    H --&gt; I
    I --&gt; J{"Are we at the root level?"}
    J --&gt;|No| D
    J --&gt;|Yes| K["Calculate diversity score (Gini coefficient)"]
    K --&gt; L{"Can we calculate a valid diversity score?"}
    L --&gt;|Yes| M["Save this solution and try next minimum count"]
    L --&gt;|No| N["Stop search - no more valid solutions"]
    M --&gt; O{"More minimum counts to try?"}
    O --&gt;|Yes| C
    O --&gt;|No| P["Remove duplicate solutions and return best options"]
    N --&gt; P
    P --&gt; Q["End: Return optimized genre groupings"]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We need to ensure that when merging a genre with its parent, we also merge all siblings and all grandchildren of the parent genre into the parent genre to avoid dangling nodes in the tree. Due to how the trees are created, merging grand children that already fulfilled the min n requirement will not occur often: Genres that are closer to the root are expected to generally appear more frequent in initial genres than genres further away from the root.</p>
</div>
</div>
</section>
<section id="tuning-results" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Tuning results</h1>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">read_feather_with_lists</span>(<span class="st">"../data/filtered_mb_long.feather"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>mb_tuning <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/tune_mb_metagenres.rds"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mb_tuning_metadata <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/tune_mb_metadata.rds"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>mb_gini_plot <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/tune_mb_gini_plot.rds"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>mb_suggested_solution <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/metagenres_mb_suggested_solution.rds"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">read_feather_with_lists</span>(<span class="st">"../data/filtered_s_long.feather"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>s_tuning <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/tune_s_metagenres.rds"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>s_tuning_metadata <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/tune_s_metadata.rds"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>s_gini_plot <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/tune_s_gini_plot.rds"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>s_suggested_solution <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../models/metagenres/metagenres_s_suggested_solution.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to get all unique solutions in range 1-50 metagenres</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>get_solutions_in_range <span class="ot">&lt;-</span> <span class="cf">function</span>(tuning, suggested_solution, <span class="at">min_genres =</span> <span class="dv">1</span>, <span class="at">max_genres =</span> <span class="dv">50</span>) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get number of metagenres in suggested solution</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  suggested_n_metagenres <span class="ot">&lt;-</span> <span class="fu">nrow</span>(suggested_solution<span class="sc">$</span>n_songs)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get solutions with unique n_metagenres in the specified range</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use the last occurrence of each n_metagenres (highest min_n)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  solutions_df <span class="ot">&lt;-</span> tuning<span class="sc">$</span>ginis <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(n_metagenres <span class="sc">&gt;=</span> min_genres, n_metagenres <span class="sc">&lt;=</span> max_genres) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(n_metagenres, dplyr<span class="sc">::</span><span class="fu">desc</span>(min_n)) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(n_metagenres, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(n_metagenres)) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">solution_id =</span> <span class="fu">as.character</span>(min_n),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%d metagenres (min_n: %s, Gini: %.3f)"</span>, </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                     n_metagenres, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">format</span>(min_n, <span class="at">big.mark =</span> <span class="st">","</span>), </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                     weighted_gini),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_suggested =</span> n_metagenres <span class="sc">==</span> suggested_n_metagenres</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Map to actual solutions and filter out incomplete ones</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  solutions_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  valid_indices <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(solutions_df))) {</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    id <span class="ot">&lt;-</span> solutions_df<span class="sc">$</span>solution_id[i]</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    solution <span class="ot">&lt;-</span> tuning<span class="sc">$</span>solutions[[id]]</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if solution is complete (has required components)</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(solution) <span class="sc">&amp;&amp;</span> </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.null</span>(solution<span class="sc">$</span>mapping) <span class="sc">&amp;&amp;</span> </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.null</span>(solution<span class="sc">$</span>metagenre_graph) <span class="sc">&amp;&amp;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">nrow</span>(solution<span class="sc">$</span>mapping) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>      n_meta <span class="ot">&lt;-</span> <span class="fu">as.character</span>(solutions_df<span class="sc">$</span>n_metagenres[i])</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>      solutions_list[[n_meta]] <span class="ot">&lt;-</span> solution</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>      valid_indices <span class="ot">&lt;-</span> <span class="fu">c</span>(valid_indices, i)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter metadata to only valid solutions</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  solutions_df <span class="ot">&lt;-</span> solutions_df[valid_indices, ]</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">solutions =</span> solutions_list,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">metadata =</span> solutions_df,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">suggested_n_metagenres =</span> suggested_n_metagenres</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>mb_all_solutions <span class="ot">&lt;-</span> <span class="fu">get_solutions_in_range</span>(mb_tuning, mb_suggested_solution)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>s_all_solutions <span class="ot">&lt;-</span> <span class="fu">get_solutions_in_range</span>(s_tuning, s_suggested_solution)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="musicbrainz-metagenres" class="level2 page-columns page-full" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="musicbrainz-metagenres"><span class="header-section-number">2.1</span> MusicBrainz Metagenres</h2>
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mb_gini_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-musicbrainz-gini" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-musicbrainz-gini-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/gini_plot_musicbrainz-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-musicbrainz-gini-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Within-hierarchy-level uniformity of distribution (weighted Gini coefficient, [0-1]) for different minimum song per genre counts when folding the MusicBrainz genre tree. Calculated for a minimum n tracks per genre of 1,000 to 14,995 with stepsize . Resulting number of metagenres ranged from 4 to 42.
</figcaption>
</figure>
</div>
<div style="margin: 20px 0;">
<p><label for="mb-solution-select" style="font-weight: bold; margin-right: 10px;">Select solution:</label> <select id="mb-solution-select" style="padding: 5px 10px; font-size: 14px;"> <option value="42">42 metagenres (min_n: 1,030, Gini: 0.520)</option> <option value="41">41 metagenres (min_n: 1,040, Gini: 0.530)</option> <option value="40">40 metagenres (min_n: 1,195, Gini: 0.530)</option> <option value="38">38 metagenres (min_n: 1,240, Gini: 0.546)</option> <option value="36">36 metagenres (min_n: 1,245, Gini: 0.547)</option> <option value="35">35 metagenres (min_n: 1,255, Gini: 0.547)</option> <option value="34">34 metagenres (min_n: 1,270, Gini: 0.578)</option> <option value="33">33 metagenres (min_n: 1,340, Gini: 0.576)</option> <option value="32">32 metagenres (min_n: 1,395, Gini: 0.577)</option> <option value="31">31 metagenres (min_n: 1,410, Gini: 0.576)</option> <option value="29" selected="">29 metagenres (min_n: 1,520, Gini: 0.574)</option> <option value="28">28 metagenres (min_n: 1,585, Gini: 0.576)</option> <option value="27">27 metagenres (min_n: 1,600, Gini: 0.578)</option> <option value="26">26 metagenres (min_n: 1,715, Gini: 0.576)</option> <option value="25">25 metagenres (min_n: 1,765, Gini: 0.576)</option> <option value="24">24 metagenres (min_n: 1,795, Gini: 0.575)</option> <option value="23">23 metagenres (min_n: 1,885, Gini: 0.574)</option> <option value="22">22 metagenres (min_n: 1,890, Gini: 0.575)</option> <option value="21">21 metagenres (min_n: 1,920, Gini: 0.568)</option> <option value="20">20 metagenres (min_n: 1,940, Gini: 0.565)</option> <option value="19">19 metagenres (min_n: 1,970, Gini: 0.560)</option> <option value="18">18 metagenres (min_n: 1,975, Gini: 0.555)</option> <option value="17">17 metagenres (min_n: 2,465, Gini: 0.547)</option> <option value="16">16 metagenres (min_n: 2,475, Gini: 0.542)</option> <option value="15">15 metagenres (min_n: 2,660, Gini: 0.533)</option> <option value="14">14 metagenres (min_n: 2,955, Gini: 0.527)</option> <option value="13">13 metagenres (min_n: 3,475, Gini: 0.516)</option> <option value="12">12 metagenres (min_n: 4,005, Gini: 0.510)</option> <option value="11">11 metagenres (min_n: 4,820, Gini: 0.505)</option> <option value="10">10 metagenres (min_n: 5,110, Gini: 0.502)</option> <option value="9">9 metagenres (min_n: 5,885, Gini: 0.492)</option> <option value="8">8 metagenres (min_n: 6,780, Gini: 0.494)</option> <option value="7">7 metagenres (min_n: 7,225, Gini: 0.485)</option> <option value="6">6 metagenres (min_n: 7,415, Gini: 0.442)</option> <option value="5">5 metagenres (min_n: 14,490, Gini: 0.378)</option> </select></p>
</div>
<div class="column-screen-inset-right">
<div class="plot-container">
<div class="cell">
<div class="cell-output-display">
<div id="mb-plot-42" class="solution-plot" style="display: none;">
<div id="htmlwidget-4b3604a0f9b04e100ef3" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-4b3604a0f9b04e100ef3">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":34633.4716114532,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":9088.415220731094,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"},{"name":"metalcore","size":1246.689464652819,"fill":"#808080ff"},{"name":"progressive metal","size":1197.745902421936,"fill":"#808080ff"},{"name":"thrash metal","size":1243.229103356916,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":32035.83721513365,"fill":"#808080ff","children":[{"name":"ballad","size":1044.212450390434,"fill":"#808080ff"},{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":17354.66878793295,"fill":"#808080ff","children":[{"name":"dance","size":1034.507247796486,"fill":"#808080ff"},{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":23789.54127080929,"fill":"#808080ff","children":[{"name":"pop rap","size":1258.737045604546,"fill":"#808080ff"},{"name":"trap","size":1196.00108427279,"fill":"#808080ff"}]},{"name":"indie pop","size":1244.77471521653,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","ballad->pop","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance->electronic","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie pop->pop","indie rock->rock","jazz->pop","latin->pop","metal->rock","metalcore->metal","new wave->rock","pop->rock","pop rap->hip hop","pop rock->rock","power metal->heavy metal","progressive metal->metal","progressive rock->rock","punk->rock","punk rock->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop","thrash metal->metal","trap->hip hop"],"weight":[0.5556484541072864,0.8683867804313318,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.5402982752522644,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.4548338159389617,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.4640409012076397,0.5562525597257119,0.08816566024446482,0.6992382020118615,0.5340852338368983,0.4980738483109783,0.5314316980842052,0.6833578522625122,0.6563786288617565,0.5427888198783923,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842,0.6484741835439576,0.8054223852910306]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-41" class="solution-plot" style="display: none;">
<div id="htmlwidget-fea57eca32ec4bfb4ab2" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-fea57eca32ec4bfb4ab2">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":34633.4716114532,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":9088.415220731094,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"},{"name":"metalcore","size":1246.689464652819,"fill":"#808080ff"},{"name":"progressive metal","size":1197.745902421936,"fill":"#808080ff"},{"name":"thrash metal","size":1243.229103356916,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":32035.83721513365,"fill":"#808080ff","children":[{"name":"ballad","size":1044.212450390434,"fill":"#808080ff"},{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":23789.54127080929,"fill":"#808080ff","children":[{"name":"pop rap","size":1258.737045604546,"fill":"#808080ff"},{"name":"trap","size":1196.00108427279,"fill":"#808080ff"}]},{"name":"indie pop","size":1244.77471521653,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","ballad->pop","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie pop->pop","indie rock->rock","jazz->pop","latin->pop","metal->rock","metalcore->metal","new wave->rock","pop->rock","pop rap->hip hop","pop rock->rock","power metal->heavy metal","progressive metal->metal","progressive rock->rock","punk->rock","punk rock->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop","thrash metal->metal","trap->hip hop"],"weight":[0.5556484541072864,0.8683867804313318,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.4548338159389617,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.4640409012076397,0.5562525597257119,0.08816566024446482,0.6992382020118615,0.5340852338368983,0.4980738483109783,0.5314316980842052,0.6833578522625122,0.6563786288617565,0.5427888198783923,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842,0.6484741835439576,0.8054223852910306]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-40" class="solution-plot" style="display: none;">
<div id="htmlwidget-e2e93375d32141d32d98" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-e2e93375d32141d32d98">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":34633.4716114532,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":9088.415220731094,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"},{"name":"metalcore","size":1246.689464652819,"fill":"#808080ff"},{"name":"progressive metal","size":1197.745902421936,"fill":"#808080ff"},{"name":"thrash metal","size":1243.229103356916,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":33080.04966552409,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":23789.54127080929,"fill":"#808080ff","children":[{"name":"pop rap","size":1258.737045604546,"fill":"#808080ff"},{"name":"trap","size":1196.00108427279,"fill":"#808080ff"}]},{"name":"indie pop","size":1244.77471521653,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie pop->pop","indie rock->rock","jazz->pop","latin->pop","metal->rock","metalcore->metal","new wave->rock","pop->rock","pop rap->hip hop","pop rock->rock","power metal->heavy metal","progressive metal->metal","progressive rock->rock","punk->rock","punk rock->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop","thrash metal->metal","trap->hip hop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.4548338159389617,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.4640409012076397,0.5562525597257119,0.08816566024446482,0.6992382020118615,0.5340852338368983,0.4980738483109783,0.5314316980842052,0.6833578522625122,0.6563786288617565,0.5427888198783923,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842,0.6484741835439576,0.8054223852910306]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-38" class="solution-plot" style="display: none;">
<div id="htmlwidget-f866945acfb57b62e42e" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-f866945acfb57b62e42e">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":34633.4716114532,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":10286.16112315303,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"},{"name":"metalcore","size":1246.689464652819,"fill":"#808080ff"},{"name":"thrash metal","size":1243.229103356916,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":33080.04966552409,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":24985.54235508208,"fill":"#808080ff","children":[{"name":"pop rap","size":1258.737045604546,"fill":"#808080ff"}]},{"name":"indie pop","size":1244.77471521653,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie pop->pop","indie rock->rock","jazz->pop","latin->pop","metal->rock","metalcore->metal","new wave->rock","pop->rock","pop rap->hip hop","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","punk rock->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop","thrash metal->metal"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.4548338159389617,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.4640409012076397,0.5562525597257119,0.08816566024446482,0.6992382020118615,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5427888198783923,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842,0.6484741835439576]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-36" class="solution-plot" style="display: none;">
<div id="htmlwidget-c813c97392acc9bc75bd" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-c813c97392acc9bc75bd">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":34633.4716114532,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":11529.39022650995,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"},{"name":"metalcore","size":1246.689464652819,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":34324.82438074061,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":24985.54235508208,"fill":"#808080ff","children":[{"name":"pop rap","size":1258.737045604546,"fill":"#808080ff"}]},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie rock->rock","jazz->pop","latin->pop","metal->rock","metalcore->metal","new wave->rock","pop->rock","pop rap->hip hop","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","punk rock->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.4640409012076397,0.5562525597257119,0.08816566024446482,0.6992382020118615,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5427888198783923,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-35" class="solution-plot" style="display: none;">
<div id="htmlwidget-b8674471e7a671c5390f" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-b8674471e7a671c5390f">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":34633.4716114532,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":34324.82438074061,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":24985.54235508208,"fill":"#808080ff","children":[{"name":"pop rap","size":1258.737045604546,"fill":"#808080ff"}]},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie rock->rock","jazz->pop","latin->pop","metal->rock","new wave->rock","pop->rock","pop rap->hip hop","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","punk rock->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.5562525597257119,0.08816566024446482,0.6992382020118615,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5427888198783923,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-34" class="solution-plot" style="display: none;">
<div id="htmlwidget-428713ef75bf84541feb" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-428713ef75bf84541feb">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":34633.4716114532,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":34324.82438074061,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie rock->rock","jazz->pop","latin->pop","metal->rock","new wave->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","punk rock->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.5562525597257119,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5427888198783923,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-33" class="solution-plot" style="display: none;">
<div id="htmlwidget-bdd25bdc6461e734ced9" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-bdd25bdc6461e734ced9">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":35906.85677994259,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":34324.82438074061,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"latin","size":1340.339788556661,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie rock->rock","jazz->pop","latin->pop","metal->rock","new wave->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.5935162931143938,0.2484822610099942,0.4678078952169356,0.4931470782897256,0.5562525597257119,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-32" class="solution-plot" style="display: none;">
<div id="htmlwidget-f49f854afe27980c8da6" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-f49f854afe27980c8da6">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":35906.85677994259,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"pop","size":35665.16416929728,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie rock->rock","jazz->pop","metal->rock","new wave->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.5562525597257119,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-31" class="solution-plot" style="display: none;">
<div id="htmlwidget-2a84e521cc5a45dea263" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-2a84e521cc5a45dea263">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":37305.40393161082,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"pop","size":35665.16416929728,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","dance-pop->pop","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soft rock->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.6987500566028534,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.7506811964811647,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-29" class="solution-plot" style="display: block;">
<div id="htmlwidget-77d456263e98e49c1cd2" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-77d456263e98e49c1cd2">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":38715.70171434546,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"pop","size":37076.84098777182,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":18389.17603572944,"fill":"#808080ff","children":[{"name":"house","size":1521.061425081304,"fill":"#808080ff"}]},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","house->electronic","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5862531041253622,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-28" class="solution-plot" style="display: none;">
<div id="htmlwidget-26a58921afda8cd7a2bf" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-26a58921afda8cd7a2bf">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":38715.70171434546,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"pop","size":37076.84098777182,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"reggae","size":1588.368710406872,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","reggae->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0.2912867392177138,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-27" class="solution-plot" style="display: none;">
<div id="htmlwidget-43539b829f247f3049eb" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-43539b829f247f3049eb">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":38715.70171434546,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues","size":1601.116266551886,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"pop","size":38665.2096981787,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.6202446735444169,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-26" class="solution-plot" style="display: none;">
<div id="htmlwidget-66bffdc079c99e96ae7e" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-66bffdc079c99e96ae7e">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":40316.81798089734,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":12776.07969116277,"fill":"#808080ff","children":[{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"}]},{"name":"pop","size":38665.2096981787,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","death metal->metal","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.5711489549041839,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-25" class="solution-plot" style="display: none;">
<div id="htmlwidget-5c120221fc590f4a8f38" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-5c120221fc590f4a8f38">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":40316.81798089734,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":38665.2096981787,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues rock->rock","classic rock->rock","classical->pop","country->rock","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.7536454953430334,0.8212867036716518,0.2503342476087773,0.3728958436076848,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-24" class="solution-plot" style="display: none;">
<div id="htmlwidget-cbe0d2454c2acc1a71b6" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-cbe0d2454c2acc1a71b6">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":42086.56827123507,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":38665.2096981787,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","blues rock->rock","classical->pop","country->rock","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.7536454953430334,0.2503342476087773,0.3728958436076848,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-23" class="solution-plot" style="display: none;">
<div id="htmlwidget-697844b4b433de276f40" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-697844b4b433de276f40">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":43884.66333528728,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":38665.2096981787,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"r&b","size":1888.861667143211,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","country->rock","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","r&b->pop","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.3728958436076848,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0.5089817225981107,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-22" class="solution-plot" style="display: none;">
<div id="htmlwidget-eea4e3b1c25a94671717" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-eea4e3b1c25a94671717">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":43884.66333528728,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":5331.461669157132,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"}]},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":40554.07136532191,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","country->rock","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","power metal->heavy metal","progressive rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.3728958436076848,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.4980738483109783,0.6833578522625122,0.6563786288617565,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-21" class="solution-plot" style="display: none;">
<div id="htmlwidget-a6a67038f6fc318b5408" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-a6a67038f6fc318b5408">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":43884.66333528728,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"country","size":1920.156308224493,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":40554.07136532191,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","country->rock","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","progressive rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.3728958436076848,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6833578522625122,0.6563786288617565,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-20" class="solution-plot" style="display: none;">
<div id="htmlwidget-6d29d216f3084b2bed0c" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6d29d216f3084b2bed0c">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":45804.81964351177,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":40554.07136532191,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","progressive rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop","synth-pop->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6833578522625122,0.6563786288617565,0,0.2875451829711562,0.5862580820110836,0.4803813382902066,0.5439906025750842]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-19" class="solution-plot" style="display: none;">
<div id="htmlwidget-3607f08ccfb1a921ad3b" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-3607f08ccfb1a921ad3b">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":45804.81964351177,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":42494.12101035161,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","electronic->pop","folk->rock","folk rock->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","progressive rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.2355391975115447,0.4681675577827863,0.6835209335993552,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6833578522625122,0.6563786288617565,0,0.2875451829711562,0.5862580820110836,0.4803813382902066]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-18" class="solution-plot" style="display: none;">
<div id="htmlwidget-a254b6968eb24ec1c394" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-a254b6968eb24ec1c394">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":47775.93392607499,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":42494.12101035161,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"},{"name":"singer-songwriter","size":1976.114065246421,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","electronic->pop","folk->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","progressive rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","singer-songwriter->rock","soul->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.2355391975115447,0.4681675577827863,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6833578522625122,0.6563786288617565,0,0.2875451829711562,0.5862580820110836,0.4803813382902066]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-17" class="solution-plot" style="display: none;">
<div id="htmlwidget-87bcbfbd8a5a7b729a0f" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-87bcbfbd8a5a7b729a0f">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":49752.04799132141,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":42494.12101035161,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","electronic->pop","folk->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","progressive rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","soul->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.2355391975115447,0.4681675577827863,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6833578522625122,0.6563786288617565,0,0.2875451829711562,0.4803813382902066]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-16" class="solution-plot" style="display: none;">
<div id="htmlwidget-6ccb147156262b530bab" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6ccb147156262b530bab">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":52217.61867155749,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"folk","size":2476.557485742449,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":42494.12101035161,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","electronic->pop","folk->rock","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","soul->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.2355391975115447,0.4681675577827863,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6563786288617565,0,0.2875451829711562,0.4803813382902066]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-15" class="solution-plot" style="display: none;">
<div id="htmlwidget-eb6009575172753625bc" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-eb6009575172753625bc">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":54694.17615729995,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":42494.12101035161,"fill":"#808080ff","children":[{"name":"classical","size":2662.61996896637,"fill":"#808080ff"},{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","classical->pop","electronic->pop","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","soul->pop"],"weight":[0.5556484541072864,0.2503342476087773,0.2355391975115447,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6563786288617565,0,0.2875451829711562,0.4803813382902066]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-14" class="solution-plot" style="display: none;">
<div id="htmlwidget-5827da7dd66178212406" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-5827da7dd66178212406">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":54694.17615729995,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":45156.74097931798,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"soul","size":2958.425789978221,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","electronic->pop","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop","soul->pop"],"weight":[0.5556484541072864,0.2355391975115447,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6563786288617565,0,0.2875451829711562,0.4803813382902066]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-13" class="solution-plot" style="display: none;">
<div id="htmlwidget-40749254be73264a4863" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-40749254be73264a4863">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":54694.17615729995,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":48115.1667692962,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"punk","size":3475.708920882621,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","electronic->pop","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","punk->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.5556484541072864,0.2355391975115447,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0.6563786288617565,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-12" class="solution-plot" style="display: none;">
<div id="htmlwidget-e5efdb91aa12b2edc702" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5efdb91aa12b2edc702">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":58169.88507818257,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"indie rock","size":4009.881231889484,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":48115.1667692962,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","electronic->pop","hard rock->rock","heavy metal->rock","hip hop->pop","indie rock->rock","jazz->pop","metal->rock","pop->rock","pop rock->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.5556484541072864,0.2355391975115447,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.5935162931143938,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-11" class="solution-plot" style="display: none;">
<div id="htmlwidget-2260b3d51ba15231d6f8" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-2260b3d51ba15231d6f8">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":62179.76631007205,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":48115.1667692962,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","electronic->pop","hard rock->rock","heavy metal->rock","hip hop->pop","jazz->pop","metal->rock","pop->rock","pop rock->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.5556484541072864,0.2355391975115447,0.6105661311447128,0.5195488599614297,0.0613673778388014,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-10" class="solution-plot" style="display: none;">
<div id="htmlwidget-8b2e454e1e682b444cba" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-8b2e454e1e682b444cba">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":67000.05153919989,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":48115.1667692962,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"}]}]},"weights":{"key":["alternative rock->rock","electronic->pop","heavy metal->rock","hip hop->pop","jazz->pop","metal->rock","pop->rock","pop rock->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.5556484541072864,0.2355391975115447,0.5195488599614297,0.0613673778388014,0.2484822610099942,0.4931470782897256,0.08816566024446482,0.5340852338368983,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-9" class="solution-plot" style="display: none;">
<div id="htmlwidget-d1984d4a3949a89d667e" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-d1984d4a3949a89d667e">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":72112.1452549297,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":48115.1667692962,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"jazz","size":5887.5190020134,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative rock->rock","electronic->pop","heavy metal->rock","hip hop->pop","jazz->pop","metal->rock","pop->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.5556484541072864,0.2355391975115447,0.5195488599614297,0.0613673778388014,0.2484822610099942,0.4931470782897256,0.08816566024446482,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-8" class="solution-plot" style="display: none;">
<div id="htmlwidget-8127ccc0de28db9bf01c" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-8127ccc0de28db9bf01c">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":72112.1452549297,"fill":"#808080ff","children":[{"name":"alternative rock","size":6781.427134791829,"fill":"#808080ff"},{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":54002.6857713096,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative rock->rock","electronic->pop","heavy metal->rock","hip hop->pop","metal->rock","pop->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.5556484541072864,0.2355391975115447,0.5195488599614297,0.0613673778388014,0.4931470782897256,0.08816566024446482,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-7" class="solution-plot" style="display: none;">
<div id="htmlwidget-5c778641d6fce454eb56" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-5c778641d6fce454eb56">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":78893.57238972152,"fill":"#808080ff","children":[{"name":"heavy metal","size":7225.663273315501,"fill":"#808080ff"},{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":54002.6857713096,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]}]}]},"weights":{"key":["electronic->pop","heavy metal->rock","hip hop->pop","metal->rock","pop->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.2355391975115447,0.5195488599614297,0.0613673778388014,0.4931470782897256,0.08816566024446482,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-6" class="solution-plot" style="display: none;">
<div id="htmlwidget-5ec209df194b47db0841" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-5ec209df194b47db0841">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":86119.23566303702,"fill":"#808080ff","children":[{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":54002.6857713096,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"}]}]}]},"weights":{"key":["electronic->pop","hip hop->pop","metal->rock","pop->rock","rock->POPULAR MUSIC","schlager->pop"],"weight":[0.2355391975115447,0.0613673778388014,0.4931470782897256,0.08816566024446482,0,0.2875451829711562]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="mb-plot-5" class="solution-plot" style="display: none;">
<div id="htmlwidget-78f89d011740baeb0228" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-78f89d011740baeb0228">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":86119.23566303702,"fill":"#808080ff","children":[{"name":"metal","size":14491.81198124538,"fill":"#808080ff"},{"name":"pop","size":61419.43549422023,"fill":"#808080ff","children":[{"name":"electronic","size":19910.23746081074,"fill":"#808080ff"},{"name":"hip hop","size":26244.27940068663,"fill":"#808080ff"}]}]}]},"weights":{"key":["electronic->pop","hip hop->pop","metal->rock","pop->rock","rock->POPULAR MUSIC"],"weight":[0.2355391975115447,0.0613673778388014,0.4931470782897256,0.08816566024446482,0]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'mb-solution-select'</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'change'</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedValue <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plots <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">'[id^="mb-plot-"]'</span>)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  plots<span class="op">.</span><span class="fu">forEach</span>(plot <span class="kw">=&gt;</span> {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (plot<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="st">'mb-plot-'</span> <span class="op">+</span> selectedValue) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      plot<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'block'</span><span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      plot<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<script>
document.getElementById('mb-solution-select').addEventListener('change', function(e) {
  const selectedValue = e.target.value;
  const plots = document.querySelectorAll('[id^="mb-plot-"]');
  
  plots.forEach(plot => {
    if (plot.id === 'mb-plot-' + selectedValue) {
      plot.style.display = 'block';
    } else {
      plot.style.display = 'none';
    }
  });
});
</script>
</div>
</div>
</div>
</section>
<section id="spotify-metagenres" class="level2 page-columns page-full" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="spotify-metagenres"><span class="header-section-number">2.2</span> Spotify Metagenres</h2>
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>s_gini_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-spotify-gini" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spotify-gini-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/gini_plot_spotify-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spotify-gini-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Within-hierarchy-level uniformity of distribution (weighted Gini coefficient, [0-1]) for different minimum song per genre counts when folding the Spotify genre tree. Calculated for a minimum n tracks per genre of 1,000 to 14,995 with stepsize . Resulting number of metagenres ranged from 6 to 69.
</figcaption>
</figure>
</div>
<div style="margin: 20px 0;">
<p><label for="s-solution-select" style="font-weight: bold; margin-right: 10px;">Select solution:</label> <select id="s-solution-select" style="padding: 5px 10px; font-size: 14px;"> <option value="50">50 metagenres (min_n: 1,555, Gini: 0.278)</option> <option value="49">49 metagenres (min_n: 1,575, Gini: 0.278)</option> <option value="48">48 metagenres (min_n: 1,630, Gini: 0.276)</option> <option value="47">47 metagenres (min_n: 1,655, Gini: 0.274)</option> <option value="46">46 metagenres (min_n: 1,735, Gini: 0.271)</option> <option value="44">44 metagenres (min_n: 1,740, Gini: 0.264)</option> <option value="43">43 metagenres (min_n: 1,765, Gini: 0.264)</option> <option value="42">42 metagenres (min_n: 1,795, Gini: 0.276)</option> <option value="41">41 metagenres (min_n: 1,845, Gini: 0.276)</option> <option value="40">40 metagenres (min_n: 1,860, Gini: 0.286)</option> <option value="39">39 metagenres (min_n: 1,865, Gini: 0.287)</option> <option value="38">38 metagenres (min_n: 1,945, Gini: 0.285)</option> <option value="37">37 metagenres (min_n: 1,950, Gini: 0.270)</option> <option value="36">36 metagenres (min_n: 1,975, Gini: 0.284)</option> <option value="35">35 metagenres (min_n: 1,985, Gini: 0.291)</option> <option value="34">34 metagenres (min_n: 1,990, Gini: 0.282)</option> <option value="33">33 metagenres (min_n: 2,025, Gini: 0.273)</option> <option value="32">32 metagenres (min_n: 2,175, Gini: 0.267)</option> <option value="31">31 metagenres (min_n: 2,235, Gini: 0.248)</option> <option value="29">29 metagenres (min_n: 2,545, Gini: 0.254)</option> <option value="28">28 metagenres (min_n: 2,645, Gini: 0.265)</option> <option value="27" selected="">27 metagenres (min_n: 3,155, Gini: 0.245)</option> <option value="26">26 metagenres (min_n: 3,160, Gini: 0.250)</option> <option value="25">25 metagenres (min_n: 3,215, Gini: 0.232)</option> <option value="24">24 metagenres (min_n: 3,330, Gini: 0.225)</option> <option value="23">23 metagenres (min_n: 3,385, Gini: 0.231)</option> <option value="22">22 metagenres (min_n: 3,455, Gini: 0.217)</option> <option value="21">21 metagenres (min_n: 4,050, Gini: 0.214)</option> <option value="20">20 metagenres (min_n: 4,180, Gini: 0.220)</option> <option value="19">19 metagenres (min_n: 4,295, Gini: 0.203)</option> <option value="18">18 metagenres (min_n: 5,690, Gini: 0.205)</option> <option value="17">17 metagenres (min_n: 6,475, Gini: 0.212)</option> <option value="16">16 metagenres (min_n: 6,610, Gini: 0.217)</option> <option value="15">15 metagenres (min_n: 6,905, Gini: 0.215)</option> <option value="14">14 metagenres (min_n: 8,580, Gini: 0.216)</option> <option value="13">13 metagenres (min_n: 9,365, Gini: 0.223)</option> <option value="12">12 metagenres (min_n: 9,575, Gini: 0.267)</option> <option value="11">11 metagenres (min_n: 10,405, Gini: 0.346)</option> <option value="10">10 metagenres (min_n: 10,415, Gini: 0.374)</option> <option value="9">9 metagenres (min_n: 10,815, Gini: 0.394)</option> <option value="8">8 metagenres (min_n: 10,870, Gini: 0.404)</option> <option value="7">7 metagenres (min_n: 11,640, Gini: 0.380)</option> </select></p>
</div>
<div class="column-screen-inset-right">
<div class="plot-container">
<div class="cell">
<div class="cell-output-display">
<div id="s-plot-50" class="solution-plot" style="display: none;">
<div id="htmlwidget-79ff25451cea98b2fef9" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-79ff25451cea98b2fef9">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":7808.179004329004,"fill":"#808080ff","children":[{"name":"liedermacher","size":1768.74246031746,"fill":"#808080ff"}]},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":5105.562817737818,"fill":"#808080ff","children":[{"name":"industrial metal","size":1655.154797979798,"fill":"#808080ff"},{"name":"nu metal","size":1631.213539238539,"fill":"#808080ff"},{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":8477.487358882947,"fill":"#808080ff","children":[{"name":"german metal","size":1978.625937950938,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"},{"name":"neue deutsche harte","size":1737.217929292929,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"},{"name":"symphonic metal","size":1741.318001443001,"fill":"#808080ff"}]},{"name":"modern rock","size":2750.644606765783,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"},{"name":"indietronica","size":1736.871737249678,"fill":"#808080ff"}]},{"name":"new wave pop","size":6962.551850192292,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"},{"name":"new romantic","size":1578.535532523033,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":1830.193265046787,"fill":"#808080ff","children":[{"name":"classical","size":1556.815248661727,"fill":"#808080ff"}]},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","classical->operatic pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","indietronica->modern rock","industrial metal->alternative metal","latin pop->dance pop","liedermacher->german rock","medieval rock->german metal","metal->rock","modern rock->rock","neue deutsche harte->german metal","new romantic->new wave pop","new wave pop->rock","nu metal->alternative metal","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","symphonic metal->metal","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.06408716245615458,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1464900954381152,0.4160359487513766,0.2170848796899217,0.3645721462081507,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.1619935503372753,0.2022228021090763,0.07020279920411393,0.3413550418234799,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.2633270653993677,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-49" class="solution-plot" style="display: none;">
<div id="htmlwidget-65e1cf1063fa56790dbe" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-65e1cf1063fa56790dbe">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":7808.179004329004,"fill":"#808080ff","children":[{"name":"liedermacher","size":1768.74246031746,"fill":"#808080ff"}]},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":5105.562817737818,"fill":"#808080ff","children":[{"name":"industrial metal","size":1655.154797979798,"fill":"#808080ff"},{"name":"nu metal","size":1631.213539238539,"fill":"#808080ff"},{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":8477.487358882947,"fill":"#808080ff","children":[{"name":"german metal","size":1978.625937950938,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"},{"name":"neue deutsche harte","size":1737.217929292929,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"},{"name":"symphonic metal","size":1741.318001443001,"fill":"#808080ff"}]},{"name":"modern rock","size":2750.644606765783,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"},{"name":"indietronica","size":1736.871737249678,"fill":"#808080ff"}]},{"name":"new wave pop","size":6962.551850192292,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"},{"name":"new romantic","size":1578.535532523033,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","indietronica->modern rock","industrial metal->alternative metal","latin pop->dance pop","liedermacher->german rock","medieval rock->german metal","metal->rock","modern rock->rock","neue deutsche harte->german metal","new romantic->new wave pop","new wave pop->rock","nu metal->alternative metal","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","symphonic metal->metal","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1464900954381152,0.4160359487513766,0.2170848796899217,0.3645721462081507,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.1619935503372753,0.2022228021090763,0.07020279920411393,0.3413550418234799,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.2633270653993677,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-48" class="solution-plot" style="display: none;">
<div id="htmlwidget-26ab352c222bf712a4f7" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-26ab352c222bf712a4f7">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":7808.179004329004,"fill":"#808080ff","children":[{"name":"liedermacher","size":1768.74246031746,"fill":"#808080ff"}]},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":5105.562817737818,"fill":"#808080ff","children":[{"name":"industrial metal","size":1655.154797979798,"fill":"#808080ff"},{"name":"nu metal","size":1631.213539238539,"fill":"#808080ff"},{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":8477.487358882947,"fill":"#808080ff","children":[{"name":"german metal","size":1978.625937950938,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"},{"name":"neue deutsche harte","size":1737.217929292929,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"},{"name":"symphonic metal","size":1741.318001443001,"fill":"#808080ff"}]},{"name":"modern rock","size":2750.644606765783,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"},{"name":"indietronica","size":1736.871737249678,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","indietronica->modern rock","industrial metal->alternative metal","latin pop->dance pop","liedermacher->german rock","medieval rock->german metal","metal->rock","modern rock->rock","neue deutsche harte->german metal","new wave pop->rock","nu metal->alternative metal","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","symphonic metal->metal","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1464900954381152,0.4160359487513766,0.2170848796899217,0.3645721462081507,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.1619935503372753,0.07020279920411393,0.3413550418234799,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.2633270653993677,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-47" class="solution-plot" style="display: none;">
<div id="htmlwidget-77a4959aebf216b60d26" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-77a4959aebf216b60d26">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":7808.179004329004,"fill":"#808080ff","children":[{"name":"liedermacher","size":1768.74246031746,"fill":"#808080ff"}]},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":6736.776356976357,"fill":"#808080ff","children":[{"name":"industrial metal","size":1655.154797979798,"fill":"#808080ff"},{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":8477.487358882947,"fill":"#808080ff","children":[{"name":"german metal","size":1978.625937950938,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"},{"name":"neue deutsche harte","size":1737.217929292929,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"},{"name":"symphonic metal","size":1741.318001443001,"fill":"#808080ff"}]},{"name":"modern rock","size":2750.644606765783,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"},{"name":"indietronica","size":1736.871737249678,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","indietronica->modern rock","industrial metal->alternative metal","latin pop->dance pop","liedermacher->german rock","medieval rock->german metal","metal->rock","modern rock->rock","neue deutsche harte->german metal","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","symphonic metal->metal","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1464900954381152,0.4160359487513766,0.2170848796899217,0.3645721462081507,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.1619935503372753,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.2633270653993677,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-46" class="solution-plot" style="display: none;">
<div id="htmlwidget-b5322500d8924246f300" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-b5322500d8924246f300">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":7808.179004329004,"fill":"#808080ff","children":[{"name":"liedermacher","size":1768.74246031746,"fill":"#808080ff"}]},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":8477.487358882947,"fill":"#808080ff","children":[{"name":"german metal","size":1978.625937950938,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"},{"name":"neue deutsche harte","size":1737.217929292929,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"},{"name":"symphonic metal","size":1741.318001443001,"fill":"#808080ff"}]},{"name":"modern rock","size":2750.644606765783,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"},{"name":"indietronica","size":1736.871737249678,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","indietronica->modern rock","latin pop->dance pop","liedermacher->german rock","medieval rock->german metal","metal->rock","modern rock->rock","neue deutsche harte->german metal","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","symphonic metal->metal","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1464900954381152,0.2170848796899217,0.3645721462081507,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.1619935503372753,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.2633270653993677,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-44" class="solution-plot" style="display: none;">
<div id="htmlwidget-7be87bd4087203dfb558" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-7be87bd4087203dfb558">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":7808.179004329004,"fill":"#808080ff","children":[{"name":"liedermacher","size":1768.74246031746,"fill":"#808080ff"}]},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":8477.487358882947,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"},{"name":"symphonic metal","size":1741.318001443001,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","latin pop->dance pop","liedermacher->german rock","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","symphonic metal->metal","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.2170848796899217,0.3645721462081507,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.2633270653993677,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-43" class="solution-plot" style="display: none;">
<div id="htmlwidget-6251bbe2e8c331f1ecf9" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6251bbe2e8c331f1ecf9">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":7808.179004329004,"fill":"#808080ff","children":[{"name":"liedermacher","size":1768.74246031746,"fill":"#808080ff"}]},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":10218.80536032595,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","latin pop->dance pop","liedermacher->german rock","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.2170848796899217,0.3645721462081507,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-42" class="solution-plot" style="display: none;">
<div id="htmlwidget-6a20110f05af6ae37010" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6a20110f05af6ae37010">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":10218.80536032595,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","latin pop->dance pop","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.2170848796899217,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2667456192794315,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-41" class="solution-plot" style="display: none;">
<div id="htmlwidget-ef5ab2508561c43c7029" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-ef5ab2508561c43c7029">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":5012.389480596617,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"latin pop","size":1847.388850714535,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","latin pop->dance pop","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.2170848796899217,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-40" class="solution-plot" style="display: none;">
<div id="htmlwidget-da515fa0babd4495d0d4" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-da515fa0babd4495d0d4">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":13050.01937367759,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"pop dance","size":1863.948515837635,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","pop dance->pop","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2772926679992928,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-39" class="solution-plot" style="display: none;">
<div id="htmlwidget-fc52578d10d1acc601ba" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-fc52578d10d1acc601ba">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":8541.087382715325,"fill":"#808080ff","children":[{"name":"eurodance","size":1867.843235930736,"fill":"#808080ff"}]},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","eurodance->new wave pop","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08336726779832711,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-38" class="solution-plot" style="display: none;">
<div id="htmlwidget-434cc13e21cc4cc1ef15" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-434cc13e21cc4cc1ef15">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":11439.67177590383,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["album rock->rock","alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.4106765467703823,0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-37" class="solution-plot" style="display: none;">
<div id="htmlwidget-652a42b49faad55c6c6a" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-652a42b49faad55c6c6a">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":7417.120213120214,"fill":"#808080ff","children":[{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":13387.33435703186,"fill":"#808080ff","children":[{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock","volksmusik->classic schlager"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904,0.5523237630132855]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-36" class="solution-plot" style="display: none;">
<div id="htmlwidget-1a7f50dc1581ba613075" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-1a7f50dc1581ba613075">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":13387.33435703186,"fill":"#808080ff","children":[{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":3715.843867243867,"fill":"#808080ff","children":[{"name":"medieval rock","size":1978.583008658009,"fill":"#808080ff"}]},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","medieval rock->german metal","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.1495537909103471,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-35" class="solution-plot" style="display: none;">
<div id="htmlwidget-4e98919969c787eaadc4" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-4e98919969c787eaadc4">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":13387.33435703186,"fill":"#808080ff","children":[{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":4487.516344015462,"fill":"#808080ff","children":[{"name":"indie rock","size":1988.506926815015,"fill":"#808080ff"}]},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","indie rock->modern rock","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.2162153938179669,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-34" class="solution-plot" style="display: none;">
<div id="htmlwidget-65b84b438359d7a8e9a2" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-65b84b438359d7a8e9a2">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":13387.33435703186,"fill":"#808080ff","children":[{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":5495.56844207564,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"},{"name":"vocal jazz","size":1991.850765862105,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock","vocal jazz->soft rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465,0.08109055816629904]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-33" class="solution-plot" style="display: none;">
<div id="htmlwidget-e596ab12510b957790e4" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-e596ab12510b957790e4">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":13387.33435703186,"fill":"#808080ff","children":[{"name":"alternative metal","size":8391.931154956155,"fill":"#808080ff","children":[{"name":"post-grunge","size":2025.518044918045,"fill":"#808080ff"}]},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","post-grunge->alternative metal","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.4537147801660881,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-32" class="solution-plot" style="display: none;">
<div id="htmlwidget-30e8f36ca02ab49b1604" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-30e8f36ca02ab49b1604">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":13387.33435703186,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"punk","size":2178.507936507936,"fill":"#808080ff"},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","power metal->metal","progressive rock->classic rock","punk->rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2464370121645713,0.2888724523339908,0.2285771901705553,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-31" class="solution-plot" style="display: none;">
<div id="htmlwidget-875fa9f112496e6fec22" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-875fa9f112496e6fec22">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":15565.84229353979,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":5361.59055185011,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"},{"name":"progressive rock","size":2238.539222030979,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":6859.778331311152,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"},{"name":"r&b","size":2235.745173002462,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","power metal->metal","progressive rock->classic rock","r&b->dance pop","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2464370121645713,0.2888724523339908,0.1770059419208801,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-29" class="solution-plot" style="display: none;">
<div id="htmlwidget-8265c6d10fd036e925a2" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-8265c6d10fd036e925a2">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":15565.84229353979,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":7600.12977388109,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":9095.523504313614,"fill":"#808080ff","children":[{"name":"europop","size":2549.46459542636,"fill":"#808080ff"}]},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","europop->dance pop","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0.08995471815536178,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-28" class="solution-plot" style="display: none;">
<div id="htmlwidget-753b23fab592a5b3f240" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-753b23fab592a5b3f240">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":15565.84229353979,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":7600.12977388109,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"permanent wave","size":2648.029808508485,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","permanent wave->rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.3534150246796908,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-27" class="solution-plot" style="display: block;">
<div id="htmlwidget-34c3a4b6b47c8639d258" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-34c3a4b6b47c8639d258">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":10811.93758047508,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german indie","size":3159.615476190476,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":7600.12977388109,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","german hip hop->POPULAR MUSIC","german indie->german pop","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0,0.1020966628209923,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-26" class="solution-plot" style="display: none;">
<div id="htmlwidget-946f31b26383ec984cf3" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-946f31b26383ec984cf3">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":3451.261429665106,"fill":"#808080ff","children":[{"name":"electronica","size":3162.311620732209,"fill":"#808080ff"}]},{"name":"classic rock","size":7600.12977388109,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","electronica->alternative rock","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0.04021541611302044,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-25" class="solution-plot" style="display: none;">
<div id="htmlwidget-d02e3d73604e8203610e" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-d02e3d73604e8203610e">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":7600.12977388109,"fill":"#808080ff","children":[{"name":"blues rock","size":3219.747152847153,"fill":"#808080ff"}]},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","blues rock->classic rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3490471488085188,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-24" class="solution-plot" style="display: none;">
<div id="htmlwidget-77a757509917f3dd9624" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-77a757509917f3dd9624">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":14913.96788951523,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"german techno","size":3334.052794112778,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","german techno->pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.009575113042160306,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-23" class="solution-plot" style="display: none;">
<div id="htmlwidget-3108eb7c356de57ec87a" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-3108eb7c356de57ec87a">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":18248.02068362801,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":7487.419207937745,"fill":"#808080ff","children":[{"name":"operatic pop","size":3387.008513708514,"fill":"#808080ff"}]}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","operatic pop->soft rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.133714197120807,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-22" class="solution-plot" style="display: none;">
<div id="htmlwidget-0778e12a54f8ab471120" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-0778e12a54f8ab471120">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":12016.23750318309,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"},{"name":"power metal","size":3458.448340548341,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":18248.02068362801,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","pop->rock","power metal->metal","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.02373813563934793,0.2464370121645713,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-21" class="solution-plot" style="display: none;">
<div id="htmlwidget-b5276cf3d7f93170358b" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-b5276cf3d7f93170358b">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":15474.68584373143,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":18248.02068362801,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"},{"name":"rap","size":4051.592507705462,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","pop->rock","rap->pop","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.02373813563934793,0.04811521963177308,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-20" class="solution-plot" style="display: none;">
<div id="htmlwidget-f2b3a209d451073b8383" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-f2b3a209d451073b8383">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":18213.87210204828,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"hard rock","size":4181.665986790987,"fill":"#808080ff"},{"name":"metal","size":15474.68584373143,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":22299.61319133347,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","hard rock->rock","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.2656246067974438,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.02373813563934793,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-19" class="solution-plot" style="display: none;">
<div id="htmlwidget-6439b0c702d44d0ded73" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6439b0c702d44d0ded73">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":22395.53808883926,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":15474.68584373143,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":22299.61319133347,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"},{"name":"hip hop","size":4298.399302755957,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","hip hop->pop","metal->rock","modern rock->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.02601968397163987,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.02373813563934793,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-18" class="solution-plot" style="display: none;">
<div id="htmlwidget-794c94c01e4bd7ab3781" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-794c94c01e4bd7ab3781">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":22395.53808883926,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":15474.68584373143,"fill":"#808080ff","children":[{"name":"german metal","size":5694.426875901876,"fill":"#808080ff"}]},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german metal->metal","german pop->german hip hop","german rock->german pop","metal->rock","modern rock->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.222693764938617,0.008781545175598968,0.1470122247293045,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.02373813563934793,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-17" class="solution-plot" style="display: none;">
<div id="htmlwidget-d6169f59054fa66e2d4c" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-d6169f59054fa66e2d4c">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":22395.53808883926,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"modern rock","size":6476.023270830477,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","german rock->german pop","metal->rock","modern rock->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.008781545175598968,0.1470122247293045,0.09314943747872367,0.3778976473062942,0.07020279920411393,0.02373813563934793,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-16" class="solution-plot" style="display: none;">
<div id="htmlwidget-e6c5f71b0f3b2b066b97" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-e6c5f71b0f3b2b066b97">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":28871.56135966974,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"alternative rock","size":6613.573050397315,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","alternative rock->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","german rock->german pop","metal->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3995086689716452,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.008781545175598968,0.1470122247293045,0.09314943747872367,0.07020279920411393,0.02373813563934793,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-15" class="solution-plot" style="display: none;">
<div id="htmlwidget-292ad3ca687e6c1aff30" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-292ad3ca687e6c1aff30">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":13971.55305666556,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"},{"name":"schlager","size":6908.016341991342,"fill":"#808080ff"}]}]},{"name":"rock","size":35485.13441006705,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","german rock->german pop","metal->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","schlager->german pop","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.008781545175598968,0.1470122247293045,0.09314943747872367,0.07020279920411393,0.02373813563934793,0,0.01981841720631153,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-14" class="solution-plot" style="display: none;">
<div id="htmlwidget-9fa7ed64af8346c4e6e6" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-9fa7ed64af8346c4e6e6">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":20879.5693986569,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"}]}]},{"name":"rock","size":35485.13441006705,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":8583.227960879276,"fill":"#808080ff"},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","german rock->german pop","metal->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","singer-songwriter->rock","soft rock->rock"],"weight":[0.265110598420559,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.008781545175598968,0.1470122247293045,0.09314943747872367,0.07020279920411393,0.02373813563934793,0,0.2457135198545476,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-13" class="solution-plot" style="display: none;">
<div id="htmlwidget-ee23d5721c7c46412ae6" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-ee23d5721c7c46412ae6">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":20879.5693986569,"fill":"#808080ff","children":[{"name":"classic schlager","size":9367.76307026307,"fill":"#808080ff"},{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"}]}]},{"name":"rock","size":44068.36237094634,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","classic rock->rock","classic schlager->german pop","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","german rock->german pop","metal->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","soft rock->rock"],"weight":[0.265110598420559,0.3768886273661379,0.0138694291453358,0.1777525471870477,0,0.008781545175598968,0.1470122247293045,0.09314943747872367,0.07020279920411393,0.02373813563934793,0,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-12" class="solution-plot" style="display: none;">
<div id="htmlwidget-372569322510f31e7d97" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-372569322510f31e7d97">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":30247.33246891997,"fill":"#808080ff","children":[{"name":"german rock","size":9576.921464646464,"fill":"#808080ff"}]}]},{"name":"rock","size":44068.36237094634,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","classic rock->rock","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","german rock->german pop","metal->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","soft rock->rock"],"weight":[0.265110598420559,0.3768886273661379,0.1777525471870477,0,0.008781545175598968,0.1470122247293045,0.09314943747872367,0.07020279920411393,0.02373813563934793,0,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-11" class="solution-plot" style="display: none;">
<div id="htmlwidget-ff14cbaf257ab191fff8" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff14cbaf257ab191fff8">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":39824.25393356643,"fill":"#808080ff"}]},{"name":"rock","size":44068.36237094634,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"new wave pop","size":10408.93061864606,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","classic rock->rock","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","metal->rock","new wave pop->rock","pop->rock","rock->POPULAR MUSIC","soft rock->rock"],"weight":[0.265110598420559,0.3768886273661379,0.1777525471870477,0,0.008781545175598968,0.09314943747872367,0.07020279920411393,0.02373813563934793,0,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-10" class="solution-plot" style="display: none;">
<div id="htmlwidget-a517f7db81eab884d3cd" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-a517f7db81eab884d3cd">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":39824.25393356643,"fill":"#808080ff"}]},{"name":"rock","size":54477.2929895924,"fill":"#808080ff","children":[{"name":"alternative metal","size":10417.4491998742,"fill":"#808080ff"},{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["alternative metal->rock","classic rock->rock","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","metal->rock","pop->rock","rock->POPULAR MUSIC","soft rock->rock"],"weight":[0.265110598420559,0.3768886273661379,0.1777525471870477,0,0.008781545175598968,0.09314943747872367,0.02373813563934793,0,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-9" class="solution-plot" style="display: none;">
<div id="htmlwidget-3bbe3474be3504720b7c" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-3bbe3474be3504720b7c">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":39824.25393356643,"fill":"#808080ff"}]},{"name":"rock","size":64894.7421894666,"fill":"#808080ff","children":[{"name":"classic rock","size":10819.87692672824,"fill":"#808080ff"},{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["classic rock->rock","dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","metal->rock","pop->rock","rock->POPULAR MUSIC","soft rock->rock"],"weight":[0.3768886273661379,0.1777525471870477,0,0.008781545175598968,0.09314943747872367,0.02373813563934793,0,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-8" class="solution-plot" style="display: none;">
<div id="htmlwidget-29e3394d37c5a71c4240" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-29e3394d37c5a71c4240">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":39824.25393356643,"fill":"#808080ff"}]},{"name":"rock","size":75714.61911619484,"fill":"#808080ff","children":[{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]},{"name":"soft rock","size":10874.42772164626,"fill":"#808080ff"}]}]},"weights":{"key":["dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","metal->rock","pop->rock","rock->POPULAR MUSIC","soft rock->rock"],"weight":[0.1777525471870477,0,0.008781545175598968,0.09314943747872367,0.02373813563934793,0,0.2252521109744465]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="s-plot-7" class="solution-plot" style="display: none;">
<div id="htmlwidget-7ea9811f71697e6c29e8" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-7ea9811f71697e6c29e8">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":796.3333333333334,"fill":"#808080ff","children":[{"name":"german hip hop","size":19679.25258179643,"fill":"#808080ff","children":[{"name":"german pop","size":39824.25393356643,"fill":"#808080ff"}]},{"name":"rock","size":86589.0468378411,"fill":"#808080ff","children":[{"name":"metal","size":21169.11271963331,"fill":"#808080ff"},{"name":"pop","size":26598.01249408943,"fill":"#808080ff","children":[{"name":"dance pop","size":11644.98809973998,"fill":"#808080ff"}]}]}]},"weights":{"key":["dance pop->pop","german hip hop->POPULAR MUSIC","german pop->german hip hop","metal->rock","pop->rock","rock->POPULAR MUSIC"],"weight":[0.1777525471870477,0,0.008781545175598968,0.09314943747872367,0.02373813563934793,0]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_tree_plot.js */\nconst minNodeSpacing = 30;\nlet allNodeNames = [];\nlet searchedNode = null;\nlet actualHeight, actualWidth, currentHeight;\nlet currentData, hierarchyRoot, isFirstRender;\nlet zoom, container;\n\nfunction render() {\n    initLayout();\n    initZoom();\n    createContainer();\n    createUI();\n    prepareState();\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction initLayout() {\n    actualHeight = (data.height || 1000) - 4;\n    actualWidth = calculateResponsiveWidth();\n    setSvgAttributes();\n    window.addEventListener(\"resize\", () => \n        svg.attr(\"width\", calculateResponsiveWidth()));\n}\n\nfunction calculateResponsiveWidth() {\n    const style = window.getComputedStyle(svg.node());\n    const width = parseFloat(style.width);\n    return style.width && style.width !== \"auto\" && width > 0 ? \n           width - 4 : window.innerWidth * 0.8;\n}\n\nfunction setSvgAttributes() {\n    svg.attr(\"width\", actualWidth)\n        .attr(\"height\", actualHeight)\n        .style(\"background-color\", \"#fafafa\")\n        .style(\"overflow\", \"hidden\")\n        .style(\"cursor\", \"grab\")\n        .style(\"display\", \"block\");\n}\n\nfunction initZoom() {\n    zoom = d3.zoom()\n        .scaleExtent([0.1, 3])\n        .on(\"zoom\", event => {\n            container.attr(\"transform\", event.transform);\n            svg.style(\"cursor\", event.sourceEvent?.type === \"mousemove\" ? \n                     \"grabbing\" : \"grab\");\n        });\n    svg.call(zoom);\n}\n\nfunction createContainer() {\n    container = svg.append(\"g\").attr(\"class\", \"tree-container\");\n}\n\nfunction createUI() {\n    createButton(20, 20, \"Center root\", \"#007acc\", \"#005a9e\", centerOnRoot);\n    createButton(20, 60, \"Expand All\", \"#28a745\", \"#1e7e34\", expandAll);\n    createButton(20, 100, \"Fold All\", \"#dc3545\", \"#c82333\", foldAll);\n    createSearchBar();\n}\n\nfunction createButton(x, y, label, fill, stroke, callback) {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${x}, ${y})`)\n        .style(\"cursor\", \"pointer\")\n        .on(\"click\", callback);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 100).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", fill).style(\"stroke\", stroke)\n        .style(\"stroke-width\", 1);\n    \n    g.append(\"text\")\n        .attr(\"x\", 50).attr(\"y\", 20).attr(\"text-anchor\", \"middle\")\n        .style(\"fill\", \"white\").style(\"font-size\", \"12px\")\n        .style(\"font-weight\", \"bold\").style(\"pointer-events\", \"none\")\n        .text(label);\n}\n\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n    const t = d3.zoomIdentity\n        .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                   actualHeight / 2 - (hierarchyRoot.x || 0))\n        .scale(1);\n    svg.transition().duration(750).call(zoom.transform, t);\n}\n\nfunction createSearchBar() {\n    const g = svg.append(\"g\")\n        .attr(\"transform\", `translate(${actualWidth / 2 - 150}, 20)`);\n    \n    g.append(\"rect\")\n        .attr(\"width\", 300).attr(\"height\", 30).attr(\"rx\", 5)\n        .style(\"fill\", \"white\").style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 1);\n    \n    const fo = g.append(\"foreignObject\")\n        .attr(\"width\", 300).attr(\"height\", 30);\n    \n    fo.append(\"xhtml:input\")\n        .attr(\"type\", \"text\")\n        .attr(\"placeholder\", \"Search genre...\")\n        .attr(\"list\", \"tree-genre-datalist\")\n        .style(\"width\", \"290px\").style(\"height\", \"26px\")\n        .style(\"margin\", \"2px 5px\").style(\"border\", \"none\")\n        .style(\"outline\", \"none\").style(\"font-size\", \"12px\")\n        .style(\"background\", \"transparent\")\n        .on(\"keypress\", function(event) {\n            if (event.key === \"Enter\" && this.value.trim() && \n                allNodeNames.includes(this.value.trim())) {\n                focusOnNode(this.value.trim());\n                this.value = \"\";\n            }\n        });\n    \n    const dl = fo.append(\"xhtml:datalist\").attr(\"id\", \"tree-genre-datalist\");\n    allNodeNames.slice().sort()\n        .forEach(name => dl.append(\"xhtml:option\").attr(\"value\", name));\n}\n\nfunction focusOnNode(name) {\n    if (!hierarchyRoot) return;\n    \n    searchedNode = name;\n    const target = findNodeByName(hierarchyRoot, name);\n    if (!target) return;\n    \n    expandPathToNode(hierarchyRoot, name);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (target.y || 0),\n                      actualHeight / 2 - (target.x || 0))\n            .scale(1);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction expandPathToNode(root, targetName) {\n    function expand(node) {\n        if (node.data.name === targetName) return true;\n        \n        let found = false;\n        [node._children, node.children].forEach(arr => {\n            if (arr) found = arr.some(expand) || found;\n        });\n        \n        if (found && node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        \n        return found;\n    }\n    \n    expand(root);\n}\n\nfunction prepareState() {\n    currentData = JSON.parse(JSON.stringify(data.tree));\n    hierarchyRoot = null;\n    isFirstRender = true;\n    currentHeight = actualHeight;\n    \n    allNodeNames = [];\n    (function collect(node) {\n        allNodeNames.push(node.name);\n        node.children?.forEach(collect);\n    })(currentData);\n}\n\nfunction update() {\n    container.selectAll(\"*\").remove();\n    \n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseToLevel(hierarchyRoot, 0);\n        sortBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n    \n    const root = hierarchyRoot;\n    currentHeight = calculateHeight(root);\n    \n    d3.tree().size([currentHeight, actualWidth])(root);\n    \n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + actualHeight / 2;\n        d.y = d.y;\n    });\n    \n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(root.descendants()\n            .map(d => getEffSize(d))) || 1])\n        .range([4, 15]);\n    \n    const wLookup = {};\n    if (data.weights?.key) {\n        data.weights.key.forEach((k, i) => \n            wLookup[k] = data.weights.weight[i]);\n    }\n    \n    const weights = root.links()\n        .map(l => wLookup[`${l.target.data.name}->${l.source.data.name}`])\n        .filter(w => w != null);\n    \n    const wScales = weights.length > 0 ? {\n        width: d3.scaleLinear().domain(d3.extent(weights)).range([0.5, 4]),\n        color: d3.scaleLinear().domain(d3.extent(weights))\n            .range([\"#e0e0e0\", \"#000000\"])\n    } : {};\n    \n    renderLinks(root, wLookup, wScales);\n    renderNodes(root, sizeScale);\n}\n\nfunction collapseToLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    [node.children, node._children].forEach(arr => \n        arr?.forEach(c => collapseToLevel(c, depth + 1)));\n}\n\nfunction sortBySize(node) {\n    [node.children, node._children].forEach(arr => {\n        arr?.sort((a, b) => totalSize(b) - totalSize(a));\n        arr?.forEach(sortBySize);\n    });\n}\n\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) return root;\n    for (const arr of [root.children, root._children]) {\n        if (arr) {\n            for (const c of arr) {\n                const f = findNodeByName(c, name);\n                if (f) return f;\n            }\n        }\n    }\n    return null;\n}\n\nfunction hasExpandable(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && (n.children || n._children);\n}\n\nfunction isCollapsed(name) {\n    if (!name || !hierarchyRoot) return false;\n    const n = findNodeByName(hierarchyRoot, name);\n    return n && n._children && !n.children;\n}\n\nfunction totalSize(node) {\n    return (node.data.size || 0) + \n           (node.children?.reduce((s, c) => s + totalSize(c), 0) || 0) +\n           (node._children?.reduce((s, c) => s + totalSize(c), 0) || 0);\n}\n\nfunction getEffSize(node) {\n    const n = findNodeByName(hierarchyRoot, node.data.name);\n    return n && isCollapsed(node.data.name) ? totalSize(n) : node.data.size || 0;\n}\n\nfunction toggle(d) {\n    if (!d.data) return;\n    const n = findNodeByName(hierarchyRoot, d.data.name);\n    if (!n) return;\n    \n    if (n.children) {\n        n._children = n.children;\n        n.children = null;\n    } else if (n._children) {\n        n.children = n._children;\n        n._children = null;\n    }\n    \n    sortBySize(hierarchyRoot);\n    update();\n}\n\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n    \n    (function expand(n) {\n        if (n._children) {\n            n.children = n._children;\n            n._children = null;\n        }\n        n.children?.forEach(expand);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    \n    setTimeout(() => {\n        const t = d3.zoomIdentity\n            .translate(actualWidth / 2 - (hierarchyRoot.y || 0),\n                      actualHeight / 2 - (hierarchyRoot.x || 0))\n            .scale(0.7);\n        svg.transition().duration(750).call(zoom.transform, t);\n    }, 100);\n}\n\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n    \n    (function collapse(n) {\n        if (n.children) {\n            n._children = n.children;\n            n.children = null;\n        }\n        n._children?.forEach(collapse);\n    })(hierarchyRoot);\n    \n    sortBySize(hierarchyRoot);\n    update();\n    setTimeout(centerOnRoot, 100);\n}\n\nfunction calculateHeight(root) {\n    const levels = {};\n    root.descendants().forEach(n => \n        (levels[n.depth] = levels[n.depth] || []).push(n));\n    const max = Math.max(...Object.values(levels).map(a => a.length));\n    return Math.max(600, max * minNodeSpacing);\n}\n\nfunction renderLinks(root, wLookup, wScales) {\n    const links = container.selectAll(\".link\")\n        .data(root.links()).enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal().x(d => d.y).y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.color ? wScales.color(w) : \"#ccc\";\n        })\n        .style(\"stroke-width\", d => {\n            const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n            return w != null && wScales.width ? wScales.width(w) : 2;\n        });\n    \n    links.append(\"title\").text(d => {\n        const w = wLookup[`${d.target.data.name}->${d.source.data.name}`];\n        const base = `${d.target.data.name} → ${d.source.data.name}`;\n        return w != null ? `${base}\\nWeight: ${w.toFixed(4)}` : base;\n    });\n}\n\nfunction renderNodes(root, sizeScale) {\n    const g = container.selectAll(\".node\")\n        .data(root.descendants()).enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\");\n    \n    g.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffSize(d)))\n        .style(\"fill\", d => \n            searchedNode && d.data.name === searchedNode ? \"#28a745\" : \n            d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => \n            searchedNode && d.data.name === searchedNode ? \"#1e7e34\" :\n            hasExpandable(d.data.name) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => \n            searchedNode && d.data.name === searchedNode ? 3 :\n            hasExpandable(d.data.name) ? 2 : 1)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"stroke-width\", 4);\n        })\n        .on(\"mouseout\", function(e, d) {\n            const w = searchedNode && d.data.name === searchedNode ? 3 :\n                     hasExpandable(d.data.name) ? 2 : 1;\n            d3.select(this).style(\"stroke-width\", w);\n        });\n    \n    g.filter(d => hasExpandable(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\").attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\").style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\").style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n    \n    g.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandable(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandable(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandable(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandable(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\")\n        .style(\"cursor\", d => hasExpandable(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", (e, d) => {\n            e.stopPropagation();\n            const n = findNodeByName(hierarchyRoot, d.data.name);\n            if (n && (n._children || n.children)) toggle(d);\n        })\n        .on(\"mouseover\", function(e, d) {\n            if (hasExpandable(d.data.name)) \n                d3.select(this).style(\"fill\", \"#0044aa\");\n        })\n        .on(\"mouseout\", function(e, d) {\n            d3.select(this).style(\"fill\", \n                hasExpandable(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n    \n    g.append(\"title\").text(d => {\n        const eff = getEffSize(d);\n        const orig = d.data.size || 0;\n        const name = d.data.name;\n        \n        if (hasExpandable(name)) {\n            const action = isCollapsed(name) ? \"expand\" : \"collapse\";\n            return isCollapsed(name) && eff > orig ? \n                   `${name} (Click to ${action}) - Aggregated size: ${eff} (own: ${orig})` :\n                   `${name} (Click to ${action}) - Size: ${eff}`;\n        }\n        \n        return `${name} - Size: ${eff}`;\n    });\n}\n\nrender();\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'s-solution-select'</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'change'</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedValue <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plots <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">'[id^="s-plot-"]'</span>)<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  plots<span class="op">.</span><span class="fu">forEach</span>(plot <span class="kw">=&gt;</span> {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (plot<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="st">'s-plot-'</span> <span class="op">+</span> selectedValue) {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      plot<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'block'</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      plot<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<script>
document.getElementById('s-solution-select').addEventListener('change', function(e) {
  const selectedValue = e.target.value;
  const plots = document.querySelectorAll('[id^="s-plot-"]');
  
  plots.forEach(plot => {
    if (plot.id === 's-plot-' + selectedValue) {
      plot.style.display = 'block';
    } else {
      plot.style.display = 'none';
    }
  });
});
</script>
</div>
</div>
</div>
</section>
</section>
<section id="metagenre-assignment" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Metagenre assignment</h1>
<p>Once an optimal metagenre configuration has been selected based on the tuning results, we can assign metagenres to our songs. For the assignment, all tags that were assigned to a track by platform users were mapped to their corresponding metagenres using the selected solution’s mapping table. If a track had multiple tags that mapped to different metagenres, we employed a majority voting approach to determine the final metagenre assignment. As a tie breaker, we selected the metagenre with fewest overall votes assigned to it in the dataset, promoting a more balanced distribution across metagenres. For our proof of concept random forest classifier, we chose two solutions per platfrom in the range of 10-15 and 25-30 metagenres (local minimum of Gini). Please find below the distribution of metagenres in the assigned datasets as well as the median relative probabilities for the assigned metagenres based on the majority votes.</p>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plot_metagenre_prevs <span class="ot">&lt;-</span> <span class="cf">function</span>(mapping){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  meta_prev <span class="ot">&lt;-</span> mapping <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">count</span>(metagenre, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">relfreq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">metagenre =</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(metagenre) <span class="sc">|&gt;</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>()) </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(meta_prev, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> relfreq, <span class="at">y =</span> metagenre)) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"grey45"</span>) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%s"</span>, <span class="fu">format</span>(n, <span class="at">big.mark =</span> <span class="st">","</span>))), </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">"Relative Frequency (%)"</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>), </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"grey45"</span>), </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(), </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>plot_metagenre_assignement_certainty <span class="ot">&lt;-</span> <span class="cf">function</span>(mapping){</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  meta_probs <span class="ot">&lt;-</span> mapping <span class="sc">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">"p_"</span>), <span class="st">"metagenre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">max_p =</span> <span class="fu">do.call</span>(pmax, dplyr<span class="sc">::</span><span class="fu">select</span>(., <span class="sc">-</span><span class="st">"metagenre"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(metagenre) <span class="sc">%&gt;%</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">median_probability =</span> <span class="fu">median</span>(max_p, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iqr_probability =</span> <span class="fu">IQR</span>(max_p, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(median_probability)) <span class="sc">|&gt;</span> </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">metagenre =</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(metagenre) <span class="sc">|&gt;</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>())</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(meta_probs, </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> median_probability, <span class="at">y =</span> metagenre)) <span class="sc">+</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"grey65"</span>) <span class="sc">+</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_errorbar</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xmin =</span> median_probability <span class="sc">-</span> iqr_probability <span class="sc">/</span> <span class="dv">2</span>, </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">xmax =</span> median_probability <span class="sc">+</span> iqr_probability <span class="sc">/</span> <span class="dv">2</span>), </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                       <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">"Median Relative Freq of Votes (%)"</span>) <span class="sc">+</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>), </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"grey45"</span>), </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>                   <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(), </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>                   <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>mb_10_15 <span class="ot">&lt;-</span> <span class="fu">read_feather_with_lists</span>(<span class="st">"../models/metagenres/mb_metagenres_10_15.feather"</span>)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>mb_25_30 <span class="ot">&lt;-</span> <span class="fu">read_feather_with_lists</span>(<span class="st">"../models/metagenres/mb_metagenres_25_30.feather"</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>s_10_15 <span class="ot">&lt;-</span> <span class="fu">read_feather_with_lists</span>(<span class="st">"../models/metagenres/s_metagenres_10_15.feather"</span>)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>s_25_30 <span class="ot">&lt;-</span> <span class="fu">read_feather_with_lists</span>(<span class="st">"../models/metagenres/s_metagenres_25_30.feather"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="musicbrainz-metagenre-assignment" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="musicbrainz-metagenre-assignment"><span class="header-section-number">3.1</span> MusicBrainz Metagenre Assignment</h2>
<section id="musicbrainz-10-metagenres" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="musicbrainz-10-metagenres"><span class="header-section-number">3.1.1</span> MusicBrainz 10 Metagenres</h3>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_prevs</span>(mb_10_15)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/mb%201015%20prev-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Assignement prevalences and corresponding number of tracks in the dataset per metagenre</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-cap: "Median relative frequency of votes for assigned metagenres with interquartile range error bars"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_assignement_certainty</span>(mb_10_15)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/mb%201015%20certainty-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="musicbrainz-29-metagenres" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="musicbrainz-29-metagenres"><span class="header-section-number">3.1.2</span> MusicBrainz 29 Metagenres</h3>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_prevs</span>(mb_25_30)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/mb%202530%20prev-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Assignement prevalences and corresponding number of tracks in the dataset per metagenre</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-cap: "Median relative frequency of votes for assigned metagenres with interquartile range error bars"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_assignement_certainty</span>(mb_25_30)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/mb%202530%20certainty-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="spotify-metagenre-assignment" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="spotify-metagenre-assignment"><span class="header-section-number">3.2</span> Spotify Metagenre Assignment</h2>
<section id="spotify-15-metagenres" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="spotify-15-metagenres"><span class="header-section-number">3.2.1</span> Spotify 15 Metagenres</h3>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_prevs</span>(s_10_15)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/s%201015%20prev-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Assignement prevalences and corresponding number of tracks in the dataset per metagenre</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-cap: "Median relative frequency of votes for assigned metagenres with interquartile range error bars"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_assignement_certainty</span>(s_10_15)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/s%201015%20certainty-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spotify-25-metagenres" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="spotify-25-metagenres"><span class="header-section-number">3.2.2</span> Spotify 25 Metagenres</h3>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_prevs</span>(s_25_30)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/s%202530%20prev-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Assignement prevalences and corresponding number of tracks in the dataset per metagenre</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-cap: "Median relative frequency of votes for assigned metagenres with interquartile range error bars"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_metagenre_assignement_certainty</span>(s_25_30)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_metagenres_files/figure-html/s%202530%20certainty-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>