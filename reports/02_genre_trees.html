<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Markus Radke">
<meta name="dcterms.date" content="2025-10-31">

<title>Genre Trees - Genre Discourse Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="02_genre_trees_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_genre_trees_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="02_genre_trees_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="02_genre_trees_files/libs/quarto-html/popper.min.js"></script>
<script src="02_genre_trees_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_genre_trees_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_genre_trees_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_genre_trees_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_genre_trees_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_genre_trees_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_genre_trees_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="02_genre_trees_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="02_genre_trees_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="02_genre_trees_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="02_genre_trees_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="02_genre_trees_files/libs/r2d3-render-0.1.0/r2d3-render.js"></script>

<script src="02_genre_trees_files/libs/webcomponents-2.0.0/webcomponents.js"></script>

<script src="02_genre_trees_files/libs/r2d3-binding-0.2.6/r2d3.js"></script>

<script src="02_genre_trees_files/libs/d3v6-6.2.0/d3.min.js"></script>



<link rel="stylesheet" href="styles.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="5">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#short-explanation" id="toc-short-explanation" class="nav-link active" data-scroll-target="#short-explanation"><span class="header-section-number">1</span> Short Explanation</a>
  <ul>
  <li><a href="#the-intital-genre-network" id="toc-the-intital-genre-network" class="nav-link" data-scroll-target="#the-intital-genre-network"><span class="header-section-number">1.1</span> The intital genre network</a></li>
  <li><a href="#network-of-descendant-genres" id="toc-network-of-descendant-genres" class="nav-link" data-scroll-target="#network-of-descendant-genres"><span class="header-section-number">1.2</span> Network of descendant genres</a></li>
  <li><a href="#radically-democratic-genre-trees" id="toc-radically-democratic-genre-trees" class="nav-link" data-scroll-target="#radically-democratic-genre-trees"><span class="header-section-number">1.3</span> ‘Radically democratic’ genre trees</a></li>
  </ul></li>
  <li><a href="#genre-tree-for-musicbrainz" id="toc-genre-tree-for-musicbrainz" class="nav-link" data-scroll-target="#genre-tree-for-musicbrainz"><span class="header-section-number">2</span> Genre Tree for MusicBrainz</a></li>
  <li><a href="#genre-tree-for-spotify" id="toc-genre-tree-for-spotify" class="nav-link" data-scroll-target="#genre-tree-for-spotify"><span class="header-section-number">3</span> Genre Tree for Spotify</a></li>
  </ul>
<div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/markusradke/GenreDiscourseAnalysis"><i class="bi bi-link-45deg"></i>Github Repository</a></li><li><a href="https://github.com/markusradke/GenreDiscourseAnalysis/blob/main/analysis/01_build_genre_trees.R"><i class="bi bi-file-code"></i>Corresponding Analysis script</a></li><li><a href="https://github.com/markusradke/GenreDiscourseAnalysis/blob/main/R/build_genre_tree.R"><i class="bi bi-file-code"></i>Helper functions - Tree Building</a></li><li><a href="https://github.com/markusradke/GenreDiscourseAnalysis/blob/main/R/map_genres.R"><i class="bi bi-file-code"></i>Helper functions - Initial Genre Mapping</a></li><li><a href="https://github.com/markusradke/GenreDiscourseAnalysis/blob/main/R/make_network_graph.R"><i class="bi bi-file-code"></i>Helper functions - Tree Plotting</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Genre Trees - Genre Discourse Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Markus Radke </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 31, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="short-explanation" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Short Explanation</h1>
<p>This report presents interactive genre trees for the MusicBrainz and the digital music streaming platform Spotify. Each tree visualizes the <strong>hierarchical structure of music genres</strong> based on a dataset of popular tracks in Germany over the last 50 years (PopTraG). The trees allow users to explore sub-genres by clicking on nodes, with node size representing the number of tracks associated with each genre.</p>
<section id="the-intital-genre-network" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="the-intital-genre-network"><span class="header-section-number">1.1</span> The intital genre network</h2>
<p>In the initial genre network, <strong>each node represents a genre tag</strong> on the corresponding platform. The <strong>edges of this initial network are based on the co-occurrence</strong> of genre tags across all tracks in the PopTraG dataset (i.e., the probability that a certain genre tag appears, given that another genre tag was assigned to a track; see example with “pop” and “hip hop” below). The more frequently two genres co-occur, the stronger the connection (edge) between them. Musicbrainz provides additional community votes for genre assignments (for Spotify we used multiple artists per track to generate votes), which are used to <strong>weight the edges genre network</strong>. Here, we multiplied the link strengh by the mean relative vote for a genre across all tracks where both genres appear. The more users voted for a genre, i.e.&nbsp;the more unambigously a track can be assigned to a genre, the stronger the connection becomes (see continued example).</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
rock -- P(metal|rock) * meanRelFreqVotes(metal|rock) --&gt; metal
metal -- P(rock|metal) * meanRelFreqVotes(rock|metal) --&gt; rock
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="network-of-descendant-genres" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="network-of-descendant-genres"><span class="header-section-number">1.2</span> Network of descendant genres</h2>
<p>Next, we determine which genre is a descendant of the other. Genres with descendants should be distributed more evenly across multiple genres. Thus, in our initial genre network, we eliminate the weaker connection between the two genres. To account for the uncertainty in this decision, we subtract the weaker conditional probability from the conditional probability of the stronger connection (see the continued example).</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
rock -. P(metal|rock) .-x metal
metal -- P(rock|metal) - P(rock|metal) --&gt; rock
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="radically-democratic-genre-trees" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="radically-democratic-genre-trees"><span class="header-section-number">1.3</span> ‘Radically democratic’ genre trees</h2>
<p>Now, we transform the directed network of descendant genres into a hierarchical tree. We assume that the strongest link to a potential parent genre determines the most suitable parent genre. Thus, we eliminate all other outgoing links to potential parents (see the continued example).</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
metal --&gt; rock
metal -.-x pop
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<!-- ## Genre mapping
For performing classification tasks later on, we need to transform our multilabel genre assignments into single-label assignements. Therefore, we choose the initial genre from each track's user assigned tags. We identify the most appropriate initial genre by following the path from the root of the tree to the leaf genres, always choosing the path with the highest number of votes down all sub-branches in the tracks genre list. When we reach a genre that has no heirs in the track's genre list, we assign this genre as the initial genre for this track. -->
<!-- Was ist mit einem Fall, wo zwar ein Track in einem Tiefen Genre ist, aber nicht der gesamte Path? Das könnte zum Beispiel Classical erklären in den Leafs? Die bleiben vielleicht alle bei Classic Rock stecken und kommen gar nicht zu classical -->
<!-- TODO: Make an example plot / multiple example plots -->
</section>
</section>
<section id="genre-tree-for-musicbrainz" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Genre Tree for MusicBrainz</h1>
<div class="column-screen-inset-right">
<div class="plot-container">
<p><strong>Navigation:</strong> Click and drag to pan • Mouse wheel to zoom in/out • Click “Center Root” to reset view • Click blue nodes to expand/collapse</p>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-84b3e60f2ecedc70c9c2" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-84b3e60f2ecedc70c9c2">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"rock","size":22754.41083295581,"fill":"#808080ff","children":[{"name":"acoustic rock","size":368.1568515550677,"fill":"#808080ff"},{"name":"alternative metal","size":869.5779189504609,"fill":"#808080ff"},{"name":"alternative punk","size":100.568363384346,"fill":"#808080ff"},{"name":"alternative rock","size":5957.409811532877,"fill":"#808080ff","children":[{"name":"grunge","size":336.8580833126727,"fill":"#808080ff"},{"name":"post-hardcore","size":487.1592399462788,"fill":"#808080ff"}]},{"name":"americana","size":200.4201420643128,"fill":"#808080ff"},{"name":"aor","size":172.8848687880039,"fill":"#808080ff"},{"name":"arena rock","size":242.4679268180245,"fill":"#808080ff"},{"name":"art rock","size":651.4246411283676,"fill":"#808080ff"},{"name":"avant-garde","size":110.7279960409773,"fill":"#808080ff"},{"name":"blues","size":1364.597304916368,"fill":"#808080ff","children":[{"name":"country blues","size":76.66358389225229,"fill":"#808080ff"},{"name":"electric blues","size":159.8553777432657,"fill":"#808080ff"}]},{"name":"blues rock","size":1798.095064052215,"fill":"#808080ff"},{"name":"britpop","size":432.9642581194458,"fill":"#808080ff"},{"name":"classic rock","size":1769.750290337726,"fill":"#808080ff"},{"name":"contemporary folk","size":227.6947705930057,"fill":"#808080ff"},{"name":"country","size":1455.081058557043,"fill":"#808080ff","children":[{"name":"alternative country","size":104.9791884455264,"fill":"#808080ff"},{"name":"bluegrass","size":168.7904394514127,"fill":"#808080ff"},{"name":"classic country","size":29.99287312305253,"fill":"#808080ff"},{"name":"contemporary country","size":161.3127486474588,"fill":"#808080ff"}]},{"name":"country rock","size":433.3716889864814,"fill":"#808080ff"},{"name":"emo","size":227.718021837817,"fill":"#808080ff"},{"name":"experimental","size":364.6642836257008,"fill":"#808080ff"},{"name":"experimental rock","size":202.0063537553769,"fill":"#808080ff"},{"name":"folk","size":2221.312824107813,"fill":"#808080ff","children":[{"name":"celtic","size":255.2446616346367,"fill":"#808080ff"}]},{"name":"folk rock","size":1971.114282563218,"fill":"#808080ff"},{"name":"funk rock","size":100.8343505235328,"fill":"#808080ff"},{"name":"garage rock","size":251.2050304068328,"fill":"#808080ff"},{"name":"glam","size":111.1116526390962,"fill":"#808080ff"},{"name":"glam rock","size":268.2863613721147,"fill":"#808080ff"},{"name":"gospel","size":220.302941485983,"fill":"#808080ff"},{"name":"gothic rock","size":465.2132154976595,"fill":"#808080ff"},{"name":"hard rock","size":4820.285229127846,"fill":"#808080ff"},{"name":"heavy metal","size":4936.784515272203,"fill":"#808080ff","children":[{"name":"power metal","size":1894.201604158369,"fill":"#808080ff"},{"name":"speed metal","size":394.6771538849294,"fill":"#808080ff"}]},{"name":"indie rock","size":3359.059874852542,"fill":"#808080ff","children":[{"name":"chamber pop","size":163.5349372923025,"fill":"#808080ff"},{"name":"dream pop","size":122.1441200453094,"fill":"#808080ff"},{"name":"indie folk","size":365.1422996993297,"fill":"#808080ff"}]},{"name":"industrial rock","size":197.4600451584405,"fill":"#808080ff"},{"name":"instrumental","size":402.9408248824395,"fill":"#808080ff"},{"name":"instrumental rock","size":71.46656386900467,"fill":"#808080ff"},{"name":"j-rock","size":79.42295482295482,"fill":"#808080ff"},{"name":"jazz rock","size":69.21244250773456,"fill":"#808080ff"},{"name":"mainstream rock","size":73.77851247184091,"fill":"#808080ff"},{"name":"metal","size":4133.059779758336,"fill":"#808080ff","children":[{"name":"black metal","size":874.3879406558353,"fill":"#808080ff"},{"name":"death metal","size":1715.732290082613,"fill":"#808080ff"},{"name":"doom metal","size":375.3886301892986,"fill":"#808080ff"},{"name":"folk metal","size":625.1870077634784,"fill":"#808080ff"},{"name":"gothic metal","size":705.2748391728343,"fill":"#808080ff"},{"name":"grindcore","size":223.954643967144,"fill":"#808080ff"},{"name":"groove metal","size":257.9240264551634,"fill":"#808080ff"},{"name":"industrial metal","size":489.0766987420416,"fill":"#808080ff"},{"name":"melodic death metal","size":782.8818300371265,"fill":"#808080ff"},{"name":"metalcore","size":1246.689464652819,"fill":"#808080ff"},{"name":"progressive metal","size":1197.745902421936,"fill":"#808080ff"},{"name":"symphonic metal","size":621.2798239898365,"fill":"#808080ff"},{"name":"thrash metal","size":1243.229103356916,"fill":"#808080ff"}]},{"name":"neo-psychedelia","size":136.4470756837379,"fill":"#808080ff"},{"name":"new wave","size":1398.547151668231,"fill":"#808080ff"},{"name":"nu metal","size":459.6803204043478,"fill":"#808080ff"},{"name":"piano rock","size":65.8527993498034,"fill":"#808080ff"},{"name":"pop","size":23486.84122980115,"fill":"#808080ff","children":[{"name":"2000s","size":49.99808751471309,"fill":"#808080ff"},{"name":"2020s","size":91.24745243591275,"fill":"#808080ff"},{"name":"alternative pop","size":200.1607721846808,"fill":"#808080ff"},{"name":"alternative r&b","size":168.9531397763237,"fill":"#808080ff"},{"name":"art pop","size":273.426299241731,"fill":"#808080ff"},{"name":"ballad","size":1044.212450390434,"fill":"#808080ff"},{"name":"baroque pop","size":109.373518897943,"fill":"#808080ff"},{"name":"blue-eyed soul","size":232.2688384032031,"fill":"#808080ff"},{"name":"bubblegum pop","size":38.14638094959951,"fill":"#808080ff"},{"name":"chanson française","size":292.241627202347,"fill":"#808080ff"},{"name":"christmas music","size":260.5680573537604,"fill":"#808080ff"},{"name":"classical","size":1833.431500888218,"fill":"#808080ff","children":[{"name":"classical crossover","size":273.3906529068664,"fill":"#808080ff"},{"name":"contemporary classical","size":142.2695418745341,"fill":"#808080ff"},{"name":"opera","size":238.1777872998461,"fill":"#808080ff"},{"name":"orchestral","size":89.92118104260048,"fill":"#808080ff"},{"name":"romantic classical","size":85.42930495430495,"fill":"#808080ff"}]},{"name":"contemporary r&b","size":994.752237912954,"fill":"#808080ff"},{"name":"country pop","size":165.2157435686923,"fill":"#808080ff"},{"name":"dance-pop","size":1411.676818474549,"fill":"#808080ff"},{"name":"dance-rock","size":127.9264313642869,"fill":"#808080ff"},{"name":"disco","size":611.8026142791219,"fill":"#808080ff"},{"name":"easy listening","size":524.6607062285741,"fill":"#808080ff"},{"name":"electronic","size":6428.587533000805,"fill":"#808080ff","children":[{"name":"acid jazz","size":140.0401425115145,"fill":"#808080ff"},{"name":"alternative dance","size":165.3424941088773,"fill":"#808080ff"},{"name":"ambient","size":939.996271186962,"fill":"#808080ff"},{"name":"big beat","size":86.10965396964725,"fill":"#808080ff"},{"name":"breakbeat","size":113.866081326574,"fill":"#808080ff"},{"name":"breaks","size":49.47966049520095,"fill":"#808080ff"},{"name":"chillout","size":122.1224432342745,"fill":"#808080ff"},{"name":"club","size":171.0261486980395,"fill":"#808080ff"},{"name":"dance","size":1034.507247796486,"fill":"#808080ff"},{"name":"dark wave","size":256.8178041585701,"fill":"#808080ff"},{"name":"downtempo","size":762.3634168741364,"fill":"#808080ff"},{"name":"drum and bass","size":275.1136325394053,"fill":"#808080ff"},{"name":"dub","size":117.7914030809628,"fill":"#808080ff"},{"name":"dubstep","size":258.169417308536,"fill":"#808080ff"},{"name":"ebm","size":239.3542555612602,"fill":"#808080ff"},{"name":"edm","size":349.9510647017244,"fill":"#808080ff"},{"name":"electro","size":615.6454138587078,"fill":"#808080ff"},{"name":"electro house","size":321.7263584915907,"fill":"#808080ff"},{"name":"electronic rock","size":62.72407620255063,"fill":"#808080ff"},{"name":"electronica","size":331.589396921713,"fill":"#808080ff"},{"name":"euro house","size":288.0821452396399,"fill":"#808080ff"},{"name":"eurodance","size":387.4622249511522,"fill":"#808080ff"},{"name":"garage house","size":19.43373300812896,"fill":"#808080ff"},{"name":"glitch","size":26.98315620390111,"fill":"#808080ff"},{"name":"gothic","size":275.8994819823869,"fill":"#808080ff"},{"name":"grime","size":68.59078234137797,"fill":"#808080ff"},{"name":"hardstyle","size":251.1185286935287,"fill":"#808080ff"},{"name":"house","size":1345.977037020977,"fill":"#808080ff","children":[{"name":"deep house","size":175.0843880603276,"fill":"#808080ff"}]},{"name":"idm","size":176.5203569743237,"fill":"#808080ff"},{"name":"indietronica","size":115.932436470594,"fill":"#808080ff"},{"name":"industrial","size":507.5216288391593,"fill":"#808080ff"},{"name":"jungle","size":32.40406800629711,"fill":"#808080ff"},{"name":"leftfield","size":65.96611916966481,"fill":"#808080ff"},{"name":"modern classical","size":320.6247308060913,"fill":"#808080ff"},{"name":"new age","size":450.2027514338657,"fill":"#808080ff"},{"name":"progressive house","size":235.8960594026011,"fill":"#808080ff"},{"name":"progressive trance","size":88.82513951640513,"fill":"#808080ff"},{"name":"tech house","size":135.7238592481735,"fill":"#808080ff"},{"name":"techno","size":729.0594692054627,"fill":"#808080ff"},{"name":"trance","size":857.3445310037359,"fill":"#808080ff","children":[{"name":"vocal trance","size":80.24821408094157,"fill":"#808080ff"}]},{"name":"trip hop","size":360.3859372634601,"fill":"#808080ff"},{"name":"uk garage","size":72.62676586100667,"fill":"#808080ff"}]},{"name":"electropop","size":727.296602325549,"fill":"#808080ff"},{"name":"europop","size":702.6575255399431,"fill":"#808080ff"},{"name":"folk pop","size":241.5995095952317,"fill":"#808080ff"},{"name":"funk","size":499.4781742860859,"fill":"#808080ff"},{"name":"hip hop","size":21255.30853519097,"fill":"#808080ff","children":[{"name":"alternative hip hop","size":117.3349274380431,"fill":"#808080ff"},{"name":"boom bap","size":91.26746211218091,"fill":"#808080ff"},{"name":"chillwave","size":70.2463825063825,"fill":"#808080ff"},{"name":"conscious hip hop","size":218.4607260560927,"fill":"#808080ff"},{"name":"east coast hip hop","size":392.3404772393251,"fill":"#808080ff"},{"name":"gangsta rap","size":820.9221133635159,"fill":"#808080ff"},{"name":"hardcore hip hop","size":115.4858053968631,"fill":"#808080ff"},{"name":"instrumental hip hop","size":74.53736386735613,"fill":"#808080ff"},{"name":"lo-fi","size":115.3902496897617,"fill":"#808080ff"},{"name":"lo-fi hip hop","size":69.2609237984238,"fill":"#808080ff"},{"name":"pop rap","size":1258.737045604546,"fill":"#808080ff"},{"name":"southern hip hop","size":232.3734056284559,"fill":"#808080ff"},{"name":"trap","size":1196.00108427279,"fill":"#808080ff"},{"name":"underground hip hop","size":38.92164613164613,"fill":"#808080ff"},{"name":"west coast hip hop","size":177.6912523902724,"fill":"#808080ff"}]},{"name":"indie pop","size":1244.77471521653,"fill":"#808080ff"},{"name":"j-pop","size":215.7319735819736,"fill":"#808080ff"},{"name":"jazz","size":4117.011764734501,"fill":"#808080ff","children":[{"name":"bebop","size":34.63160536745676,"fill":"#808080ff"},{"name":"big band","size":65.98858596911531,"fill":"#808080ff"},{"name":"bossa nova","size":112.2293304081539,"fill":"#808080ff"},{"name":"contemporary jazz","size":220.8922468324772,"fill":"#808080ff"},{"name":"cool jazz","size":32.99177232312638,"fill":"#808080ff"},{"name":"jazz fusion","size":166.7217493670188,"fill":"#808080ff"},{"name":"jazz-funk","size":125.4663865207405,"fill":"#808080ff"},{"name":"latin jazz","size":57.10722847695465,"fill":"#808080ff"},{"name":"nu jazz","size":76.27887591323888,"fill":"#808080ff"},{"name":"post-bop","size":52.21982272970861,"fill":"#808080ff"},{"name":"smooth jazz","size":215.8727109783178,"fill":"#808080ff"},{"name":"soul jazz","size":72.7591035129568,"fill":"#808080ff"},{"name":"swing","size":177.4223936896768,"fill":"#808080ff"},{"name":"vocal jazz","size":359.925425189956,"fill":"#808080ff"}]},{"name":"k-pop","size":398.8205697528278,"fill":"#808080ff"},{"name":"latin","size":917.3713522412905,"fill":"#808080ff","children":[{"name":"reggaeton","size":306.1046702154055,"fill":"#808080ff"},{"name":"salsa","size":116.8637660999655,"fill":"#808080ff"}]},{"name":"latin pop","size":332.8403047475286,"fill":"#808080ff"},{"name":"musical","size":242.2168788088486,"fill":"#808080ff"},{"name":"pop soul","size":376.1769274327506,"fill":"#808080ff"},{"name":"r&b","size":1833.135911895997,"fill":"#808080ff","children":[{"name":"new jack swing","size":55.72575524721408,"fill":"#808080ff"}]},{"name":"reggae","size":1056.068486953427,"fill":"#808080ff","children":[{"name":"dancehall","size":357.9003954385511,"fill":"#808080ff"},{"name":"reggae-pop","size":76.49706895366138,"fill":"#808080ff"},{"name":"roots reggae","size":97.90275906123262,"fill":"#808080ff"}]},{"name":"schlager","size":7416.749722910626,"fill":"#808080ff"},{"name":"sophisti-pop","size":143.1790617498928,"fill":"#808080ff"},{"name":"soul","size":2484.217028140513,"fill":"#808080ff","children":[{"name":"motown","size":49.33247079404369,"fill":"#808080ff"},{"name":"neo soul","size":309.9179163696641,"fill":"#808080ff"},{"name":"quiet storm","size":47.12504130079948,"fill":"#808080ff"},{"name":"smooth soul","size":67.83333337320106,"fill":"#808080ff"}]},{"name":"synth-pop","size":1940.049645029703,"fill":"#808080ff"},{"name":"teen pop","size":371.9098396425612,"fill":"#808080ff"},{"name":"traditional pop","size":145.9357272550889,"fill":"#808080ff"},{"name":"west coast swing","size":10.41098330037564,"fill":"#808080ff"}]},{"name":"pop punk","size":453.6496511996723,"fill":"#808080ff"},{"name":"pop rock","size":5112.093715729796,"fill":"#808080ff"},{"name":"post-grunge","size":295.4223487719375,"fill":"#808080ff"},{"name":"post-punk","size":448.5367799219065,"fill":"#808080ff"},{"name":"post-rock","size":262.9722693524238,"fill":"#808080ff"},{"name":"power pop","size":194.9525438899712,"fill":"#808080ff"},{"name":"progressive rock","size":2465.57068023608,"fill":"#808080ff"},{"name":"psychedelic","size":67.37391064157896,"fill":"#808080ff"},{"name":"psychedelic pop","size":101.8386549985598,"fill":"#808080ff"},{"name":"psychedelic rock","size":587.8200162310443,"fill":"#808080ff"},{"name":"punk","size":2934.712831167839,"fill":"#808080ff","children":[{"name":"hardcore punk","size":434.392910700834,"fill":"#808080ff"},{"name":"ska punk","size":106.6031790139485,"fill":"#808080ff"}]},{"name":"punk rock","size":1273.385168489394,"fill":"#808080ff"},{"name":"rock and roll","size":510.0696947442261,"fill":"#808080ff"},{"name":"rockabilly","size":277.3411928065923,"fill":"#808080ff"},{"name":"shoegaze","size":85.61977953258072,"fill":"#808080ff"},{"name":"singer-songwriter","size":1856.165977223333,"fill":"#808080ff","children":[{"name":"mpb","size":119.948088023088,"fill":"#808080ff"}]},{"name":"ska","size":315.3327331981744,"fill":"#808080ff"},{"name":"soft rock","size":1410.297782734634,"fill":"#808080ff"},{"name":"southern rock","size":283.5724808032303,"fill":"#808080ff"},{"name":"stoner rock","size":190.7970407915771,"fill":"#808080ff"},{"name":"symphonic rock","size":225.898504891001,"fill":"#808080ff"}]}]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_network_plot.js */\n// Interactive Network Plot - Fully responsive dimensions\nconst minNodeSpacing = 30; // Minimum spacing between nodes to prevent overlap\n\n// Get responsive width from container with timing-safe approach\nconst getResponsiveWidth = () => {\n    // Try multiple ways to get the container width\n    const svgNode = svg.node();\n    const computedStyle = window.getComputedStyle(svgNode);\n    if (computedStyle.width && computedStyle.width !== \"auto\") {\n        const width = parseFloat(computedStyle.width);\n        if (width > 0) {\n            return width - 4;\n        }\n    }\n\n    // Fallback to viewport width\n    console.log(\"Using viewport fallback width\");\n    return window.innerWidth * 0.8;\n};\n\n// Use responsive dimensions - prioritize container dimensions over r2d3 data\nconst actualHeight = (data.height || 1000) - 4; // Reduce by 4px for borders/padding\nconst actualWidth = getResponsiveWidth();\n\n// Calculate dynamic height based on tree structure\nfunction calculateRequiredHeight(root) {\n    const visibleNodes = root.descendants();\n    const nodesByDepth = {};\n\n    // Group nodes by depth level\n    visibleNodes.forEach(node => {\n        const depth = node.depth;\n        if (!nodesByDepth[depth]) {\n            nodesByDepth[depth] = [];\n        }\n        nodesByDepth[depth].push(node);\n    });\n\n    // Find the depth level with the most nodes\n    const maxNodesAtLevel = Math.max(...Object.values(nodesByDepth).map(nodes => nodes.length));\n\n    // Calculate required height: nodes * spacing (no margins needed with pan/zoom)\n    const requiredHeight = Math.max(\n        600, // Minimum height\n        maxNodesAtLevel * minNodeSpacing\n    );\n\n    return requiredHeight;\n}\n\n// Initialize with container height, will be recalculated for tree layout\nlet currentHeight = actualHeight;\n\n// Set up the SVG to exactly match the container (no manual sizing)\nsvg.attr(\"width\", actualWidth)\n    .attr(\"height\", actualHeight)\n    .style(\"background-color\", \"#fafafa\")\n    .style(\"overflow\", \"hidden\") // Remove scrollbars\n    .style(\"cursor\", \"grab\")\n    .style(\"display\", \"block\");\n\n// Add resize handler for responsive width\nwindow.addEventListener(\"resize\", function() {\n    const newWidth = getResponsiveWidth();\n    svg.attr(\"width\", newWidth);\n\n    // If there\"s tree content, we might want to recalculate layout\n    // For now, just update the SVG width - the pan/zoom will handle positioning\n});\n\n// Add zoom behavior\nconst zoom = d3.zoom()\n    .scaleExtent([0.1, 3]) // Zoom limits\n    .on(\"zoom\", (event) => {\n        container.attr(\"transform\", event.transform);\n        // Update cursor during pan\n        svg.style(\"cursor\", event.sourceEvent && event.sourceEvent.type === \"mousemove\" ? \"grabbing\" : \"grab\");\n    });\n\nsvg.call(zoom);\n\n// Create container for tree (this will be transformed by zoom/pan)\nconst container = svg.append(\"g\")\n    .attr(\"class\", \"tree-container\");\n\n// Add center button\nconst centerButton = svg.append(\"g\")\n    .attr(\"class\", \"center-button\")\n    .attr(\"transform\", \"translate(20, 20)\")\n    .style(\"cursor\", \"pointer\");\n\n// Button background\ncenterButton.append(\"rect\")\n    .attr(\"width\", 100)\n    .attr(\"height\", 30)\n    .attr(\"rx\", 5)\n    .style(\"fill\", \"#007acc\")\n    .style(\"stroke\", \"#005a9e\")\n    .style(\"stroke-width\", 1);\n\n// Button text\ncenterButton.append(\"text\")\n    .attr(\"x\", 50)\n    .attr(\"y\", 20)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"dy\", \"0em\")\n    .style(\"fill\", \"white\")\n    .style(\"font-size\", \"12px\")\n    .style(\"font-weight\", \"bold\")\n    .style(\"pointer-events\", \"none\")\n    .text(\"Center root\");\n\n// Button click handler\ncenterButton.on(\"click\", function() {\n    centerOnRoot();\n});\n\n// Add \"Expand All\" button\nconst expandAllButton = svg.append(\"g\")\n    .attr(\"class\", \"expand-all-button\")\n    .attr(\"transform\", \"translate(20, 60)\") // Position below center button\n    .style(\"cursor\", \"pointer\");\n\n// Expand All button background\nexpandAllButton.append(\"rect\")\n    .attr(\"width\", 100)\n    .attr(\"height\", 30)\n    .attr(\"rx\", 5)\n    .style(\"fill\", \"#28a745\")\n    .style(\"stroke\", \"#1e7e34\")\n    .style(\"stroke-width\", 1);\n\n// Expand All button text\nexpandAllButton.append(\"text\")\n    .attr(\"x\", 50)\n    .attr(\"y\", 20)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"dy\", \"0em\")\n    .style(\"fill\", \"white\")\n    .style(\"font-size\", \"12px\")\n    .style(\"font-weight\", \"bold\")\n    .style(\"pointer-events\", \"none\")\n    .text(\"Expand All\");\n\n// Expand All button click handler\nexpandAllButton.on(\"click\", function() {\n    expandAll();\n});\n\n// Add \"Fold All\" button\nconst foldAllButton = svg.append(\"g\")\n    .attr(\"class\", \"fold-all-button\")\n    .attr(\"transform\", \"translate(20, 100)\") // Position below expand button\n    .style(\"cursor\", \"pointer\");\n\n// Fold All button background\nfoldAllButton.append(\"rect\")\n    .attr(\"width\", 100)\n    .attr(\"height\", 30)\n    .attr(\"rx\", 5)\n    .style(\"fill\", \"#dc3545\")\n    .style(\"stroke\", \"#c82333\")\n    .style(\"stroke-width\", 1);\n\n// Fold All button text\nfoldAllButton.append(\"text\")\n    .attr(\"x\", 50)\n    .attr(\"y\", 20)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"dy\", \"0em\")\n    .style(\"fill\", \"white\")\n    .style(\"font-size\", \"12px\")\n    .style(\"font-weight\", \"bold\")\n    .style(\"pointer-events\", \"none\")\n    .text(\"Fold All\");\n\n// Fold All button click handler\nfoldAllButton.on(\"click\", function() {\n    foldAll();\n});\n\n// Function to center the view on the root node\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n\n    // Find the actual root node position after tree layout\n    const rootNode = hierarchyRoot;\n    const rootX = rootNode.x || 0;\n    const rootY = rootNode.y || 0;\n\n    // Calculate transform to center the root in the actual viewport\n    const centerX = actualWidth / 2;\n    const centerY = actualHeight / 2; // Center in actual viewport\n\n    const transform = d3.zoomIdentity\n        .translate(centerX - rootY, centerY - rootX) // Note: x and y are swapped in horizontal tree\n        .scale(1); // Reset zoom to 1x\n\n    // Animate to center\n    svg.transition()\n        .duration(750)\n        .call(zoom.transform, transform);\n} // Copy data and create persistent hierarchy\nlet currentData = JSON.parse(JSON.stringify(data.tree));\nlet hierarchyRoot = null; // Keep the hierarchy root persistent\nlet isFirstRender = true; // Track if this is the first render\n\n// Collapse function for raw data (not used anymore but keeping for reference)\nfunction collapseToFirstLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    if (node.children) {\n        node.children.forEach(child => collapseToFirstLevel(child, depth + 1));\n    }\n}\n\n// Collapse function for D3 hierarchy nodes (the one we actually use)\nfunction collapseHierarchyToFirstLevel(node, depth = 0) {\n\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n\n    // Continue recursively for visible children\n    if (node.children) {\n        node.children.forEach(child => collapseHierarchyToFirstLevel(child, depth + 1));\n    }\n\n    // Also process hidden children to ensure deep collapse\n    if (node._children) {\n        node._children.forEach(child => collapseHierarchyToFirstLevel(child, depth + 1));\n    }\n}\n\n// Sort children by accumulated size (largest first)\nfunction sortChildrenBySize(node) {\n    // Sort visible children\n    if (node.children) {\n        node.children.sort((a, b) => calculateTotalSize(b) - calculateTotalSize(a));\n        // Recursively sort their children too\n        node.children.forEach(child => sortChildrenBySize(child));\n    }\n\n    // Sort hidden children (so they\"re in the right order when expanded)\n    if (node._children) {\n        node._children.sort((a, b) => calculateTotalSize(b) - calculateTotalSize(a));\n        // Recursively sort their children too\n        node._children.forEach(child => sortChildrenBySize(child));\n    }\n}\n\n// Find a node in the hierarchy by name\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) {\n        return root;\n    }\n    if (root.children) {\n        for (let child of root.children) {\n            const found = findNodeByName(child, name);\n            if (found) return found;\n        }\n    }\n    if (root._children) {\n        for (let child of root._children) {\n            const found = findNodeByName(child, name);\n            if (found) return found;\n        }\n    }\n    return null;\n}\n\n// Check if a node has expandable children in persistent hierarchy\nfunction hasExpandableChildren(nodeName) {\n    if (!nodeName || !hierarchyRoot) {\n        console.warn(\"hasExpandableChildren: Invalid parameters\", {\n            nodeName,\n            hierarchyRoot: !!hierarchyRoot\n        });\n        return false;\n    }\n    const persistentNode = findNodeByName(hierarchyRoot, nodeName);\n    return persistentNode && (persistentNode.children || persistentNode._children);\n}\n\n// Check if a node is collapsed in persistent hierarchy\nfunction isCollapsed(nodeName) {\n    if (!nodeName || !hierarchyRoot) {\n        console.warn(\"isCollapsed: Invalid parameters\", {\n            nodeName,\n            hierarchyRoot: !!hierarchyRoot\n        });\n        return false;\n    }\n    const persistentNode = findNodeByName(hierarchyRoot, nodeName);\n    return persistentNode && persistentNode._children && !persistentNode.children;\n}\n\n// Calculate the total size of a node including all its descendants\nfunction calculateTotalSize(node) {\n    let totalSize = node.data.size || 0;\n\n    // Add sizes from visible children\n    if (node.children) {\n        for (let child of node.children) {\n            totalSize += calculateTotalSize(child);\n        }\n    }\n\n    // Add sizes from hidden children (collapsed nodes)\n    if (node._children) {\n        for (let child of node._children) {\n            totalSize += calculateTotalSize(child);\n        }\n    }\n\n    return totalSize;\n}\n\n// Get the effective size for display (aggregated size for collapsed nodes)\nfunction getEffectiveSize(displayNode, nodeName) {\n    const persistentNode = findNodeByName(hierarchyRoot, nodeName);\n\n    if (persistentNode && isCollapsed(nodeName)) {\n        // For collapsed nodes, return the total aggregated size\n        return calculateTotalSize(persistentNode);\n    } else {\n        // For expanded nodes or leaf nodes, return their own size\n        return displayNode.data.size || 0;\n    }\n}\n\n// Toggle function\nfunction toggle(d) {\n    // Safety check for data structure\n    if (!d.data) {\n        console.error(\"Node data is undefined, skipping toggle\");\n        return;\n    }\n    // Find the corresponding node in our persistent hierarchy\n    const persistentNode = findNodeByName(hierarchyRoot, d.data.name);\n    if (!persistentNode) {\n        console.error(\"Could not find node in persistent hierarchy:\", d.data.name);\n        return;\n    }\n\n    if (persistentNode.children) {\n        persistentNode._children = persistentNode.children;\n        persistentNode.children = null;\n    } else if (persistentNode._children) {\n        persistentNode.children = persistentNode._children;\n        persistentNode._children = null;\n    }\n\n    // Re-sort the entire hierarchy to maintain size-based ordering\n    sortChildrenBySize(hierarchyRoot);\n\n    update();\n}\n\n// Expand All function\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n\n    // Recursively expand all nodes\n    function expandAllNodes(node) {\n        if (node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        if (node.children) {\n            node.children.forEach(child => expandAllNodes(child));\n        }\n    }\n\n    expandAllNodes(hierarchyRoot);\n    sortChildrenBySize(hierarchyRoot);\n    update();\n\n    // Center on root and zoom out 30%\n    setTimeout(() => {\n        if (!hierarchyRoot) return;\n\n        const rootNode = hierarchyRoot;\n        const rootX = rootNode.x || 0;\n        const rootY = rootNode.y || 0;\n\n        const centerX = actualWidth / 2;\n        const centerY = actualHeight / 2;\n\n        const transform = d3.zoomIdentity\n            .translate(centerX - rootY, centerY - rootX)\n            .scale(0.7); // Zoom out 30% (100% - 30% = 70%)\n\n        svg.transition()\n            .duration(750)\n            .call(zoom.transform, transform);\n    }, 100); // Small delay to let the tree update first\n}\n\n// Fold All function\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n\n    // Collapse everything to root only (no children visible)\n    function collapseToRoot(node) {\n        if (node.children) {\n            node._children = node.children;\n            node.children = null;\n        }\n        if (node._children) {\n            node._children.forEach(child => collapseToRoot(child));\n        }\n    }\n\n    collapseToRoot(hierarchyRoot);\n    sortChildrenBySize(hierarchyRoot);\n    update();\n\n    // Center on root with normal zoom (same as center button)\n    setTimeout(() => {\n        centerOnRoot();\n    }, 100); // Small delay to let the tree update first\n}\n\n// Update function\nfunction update() {\n    // Clear previous content (but keep the center button)\n    container.selectAll(\"*\").remove();\n\n    // Create or use existing hierarchy\n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseHierarchyToFirstLevel(hierarchyRoot, 0);\n        // Sort all nodes by accumulated size after initial setup\n        sortChildrenBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n\n    const root = hierarchyRoot;\n\n    // Calculate required height dynamically for tree layout\n    currentHeight = calculateRequiredHeight(root);\n\n    // Set up tree layout with full available space (no margins)\n    const treeLayout = d3.tree().size([currentHeight, actualWidth]);\n    treeLayout(root);\n\n    // Position the tree centered in the actual viewport\n    const startX = 0; // No left margin needed\n    const startY = actualHeight / 2; // Center in actual viewport\n\n    // Adjust all node positions\n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + startY; // Center in actual viewport\n        d.y = d.y + startX; // Start from left edge\n    });\n\n    // Scale for node sizes - now considering aggregated sizes for collapsed nodes\n    const allEffectiveSizes = root.descendants().map(d => getEffectiveSize(d, d.data.name));\n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(allEffectiveSizes) || 1])\n        .range([4, 15]);\n\n    // Create links\n    const links = container.selectAll(\".link\")\n        .data(root.links())\n        .enter()\n        .append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal()\n            .x(d => d.y)\n            .y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 2);\n\n    // Create node groups\n    const nodes = container.selectAll(\".node\")\n        .data(root.descendants())\n        .enter()\n        .append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => (d.data && hasExpandableChildren(d.data.name)) ? \"pointer\" : \"default\");\n\n    // Add circles\n    nodes.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffectiveSize(d, d.data.name)))\n        .style(\"fill\", d => d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => (d.data && hasExpandableChildren(d.data.name)) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => (d.data && hasExpandableChildren(d.data.name)) ? 2 : 1)\n        .on(\"click\", function(event, d) {\n            // Prevent zoom behavior when clicking on nodes\n            event.stopPropagation();\n\n            // Check persistent hierarchy instead of display node\n            const persistentNode = findNodeByName(hierarchyRoot, d.data.name);\n            if (persistentNode) {\n                if (persistentNode._children || persistentNode.children) {\n                    toggle(d);\n                }\n            }\n        })\n        .on(\"mouseover\", function(event, d) {\n            if (d.data && hasExpandableChildren(d.data.name)) {\n                d3.select(this).style(\"stroke-width\", 4);\n            }\n        })\n        .on(\"mouseout\", function(event, d) {\n            d3.select(this).style(\"stroke-width\", (d.data && hasExpandableChildren(d.data.name)) ? 2 : 1);\n        });\n\n    // Add +/- indicators\n    nodes.filter(d => d.data && hasExpandableChildren(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\")\n        .style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\")\n        .style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n\n    // Add labels\n    nodes.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandableChildren(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandableChildren(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandableChildren(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandableChildren(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => {\n            if (hasExpandableChildren(d.data.name)) return \"#0066cc\"; // Expandable nodes = blue\n            return \"#333\"; // Leaf nodes = dark gray\n        })\n        .style(\"cursor\", d => hasExpandableChildren(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", function(event, d) {\n            // Prevent zoom behavior when clicking on text\n            event.stopPropagation();\n\n            // Check persistent hierarchy instead of display node\n            const persistentNode = findNodeByName(hierarchyRoot, d.data.name);\n            if (persistentNode) {\n                if (persistentNode._children || persistentNode.children) {\n                    toggle(d);\n                }\n            }\n        })\n        .on(\"mouseover\", function(event, d) {\n            if (hasExpandableChildren(d.data.name)) {\n                d3.select(this).style(\"fill\", \"#0044aa\");\n            }\n        })\n        .on(\"mouseout\", function(event, d) {\n            d3.select(this).style(\"fill\", hasExpandableChildren(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n\n    // Add tooltips\n    nodes.append(\"title\")\n        .text(d => {\n            const effectiveSize = getEffectiveSize(d, d.data.name);\n            const originalSize = d.data.size || 0;\n\n            if (hasExpandableChildren(d.data.name)) {\n                const action = isCollapsed(d.data.name) ? \"expand\" : \"collapse\";\n                if (isCollapsed(d.data.name) && effectiveSize > originalSize) {\n                    return `${d.data.name} (Click to ${action}) - Aggregated size: ${effectiveSize} (own: ${originalSize})`;\n                } else {\n                    return `${d.data.name} (Click to ${action}) - Size: ${effectiveSize}`;\n                }\n            }\n            return `${d.data.name} - Size: ${effectiveSize}`;\n        });\n}\n\n// Initial render\nupdate();\n\n// Center on root after initial render\nsetTimeout(() => {\n    centerOnRoot();\n}, 100); // Small delay to ensure rendering is complete\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</section>
<section id="genre-tree-for-spotify" class="level1 page-columns page-full" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Genre Tree for Spotify</h1>
<p>Please click on the nodes to explore sub-genres. The font size is fixed to ensure readability. Node size represents the number of songs in each genre.</p>
<div class="column-screen-inset-right">
<div class="plot-container">
<p><strong>Navigation:</strong> Click and drag to pan • Mouse wheel to zoom in/out • Click “Center Root” to reset view • Click blue nodes to expand/collapse</p>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-d9ec219f3a9494530ce4" style="width:100%;height:1000px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-d9ec219f3a9494530ce4">{"x":{"data":{"tree":{"name":"POPULAR MUSIC","size":0.001,"fill":"#000000ff","children":[{"name":"background jazz","size":234,"fill":"#808080ff"},{"name":"cantopop","size":132.4285714285714,"fill":"#808080ff","children":[{"name":"classic cantopop","size":58.40476190476191,"fill":"#808080ff"},{"name":"mandopop","size":129.5,"fill":"#808080ff"}]},{"name":"classic persian pop","size":242,"fill":"#808080ff"},{"name":"german hip hop","size":10275.10800449551,"fill":"#808080ff","children":[{"name":"albanian hip hop","size":265.1936507936508,"fill":"#808080ff"},{"name":"albanian pop","size":66.46468253968254,"fill":"#808080ff"},{"name":"cologne hip hop","size":286.6376373626373,"fill":"#808080ff"},{"name":"deep german hip hop","size":971.0530122655123,"fill":"#808080ff"},{"name":"frauenrap","size":345.0642857142857,"fill":"#808080ff"},{"name":"french hip hop","size":117.5706349206349,"fill":"#808080ff"},{"name":"german alternative rap","size":1362.372111222111,"fill":"#808080ff"},{"name":"german cloud rap","size":820.1968975468975,"fill":"#808080ff"},{"name":"german drill","size":777.6902528027528,"fill":"#808080ff"},{"name":"german pop","size":8317.754513542013,"fill":"#808080ff","children":[{"name":"classic schlager","size":5301.258669108669,"fill":"#808080ff","children":[{"name":"austropop","size":1385.992857142857,"fill":"#808080ff"},{"name":"easy listening","size":656.3599567099567,"fill":"#808080ff"},{"name":"volksmusik","size":1950.642857142857,"fill":"#808080ff"}]},{"name":"german indie","size":2312.919047619047,"fill":"#808080ff","children":[{"name":"antideutsche","size":835.9464285714286,"fill":"#808080ff"}]},{"name":"german reggae","size":581.438492063492,"fill":"#808080ff"},{"name":"german rock","size":3767.041702741702,"fill":"#808080ff","children":[{"name":"deutschrock","size":1360.083333333333,"fill":"#808080ff"},{"name":"german punk","size":1237.326190476191,"fill":"#808080ff"},{"name":"kabarett","size":1322.746825396825,"fill":"#808080ff"},{"name":"liedermacher","size":1520.969047619048,"fill":"#808080ff"},{"name":"neue deutsche welle","size":622.8130952380952,"fill":"#808080ff"},{"name":"ostrock","size":685.05,"fill":"#808080ff"}]},{"name":"german singer-songwriter","size":775.1992063492063,"fill":"#808080ff"},{"name":"oldschool deutschrap","size":1137.184257409257,"fill":"#808080ff"},{"name":"schlager","size":5530.42821067821,"fill":"#808080ff","children":[{"name":"discofox","size":1054.282142857143,"fill":"#808080ff"},{"name":"partyschlager","size":323.1282106782107,"fill":"#808080ff"}]}]},{"name":"german r&b","size":155.9507936507937,"fill":"#808080ff"},{"name":"german trap","size":302.8904761904762,"fill":"#808080ff"},{"name":"german underground rap","size":416.34112178671,"fill":"#808080ff"},{"name":"hamburg hip hop","size":904.1782439782439,"fill":"#808080ff"},{"name":"kurdish hip hop","size":167.6242063492063,"fill":"#808080ff"},{"name":"lo-fi jazzhop","size":158.6666666666667,"fill":"#808080ff"},{"name":"pop urbaine","size":55.40396825396825,"fill":"#808080ff"},{"name":"psychokore","size":517.7428571428571,"fill":"#808080ff","children":[{"name":"tekk","size":152.0119047619048,"fill":"#808080ff"}]},{"name":"reggae fusion","size":447.5615363996169,"fill":"#808080ff","children":[{"name":"jamaican dancehall","size":65.48666790725613,"fill":"#808080ff"},{"name":"reggae","size":179.0782399746796,"fill":"#808080ff","children":[{"name":"lovers rock","size":41.01493481578621,"fill":"#808080ff"},{"name":"modern reggae","size":42.14941432836169,"fill":"#808080ff"},{"name":"roots reggae","size":132.973842574694,"fill":"#808080ff"}]}]},{"name":"swedish hip hop","size":117.3674353424353,"fill":"#808080ff"},{"name":"turkish hip hop","size":218.0297008547008,"fill":"#808080ff","children":[{"name":"turkish pop","size":251.8666666666667,"fill":"#808080ff"}]},{"name":"uk hip hop","size":64.34606782106782,"fill":"#808080ff"}]},{"name":"rain","size":200.5,"fill":"#808080ff","children":[{"name":"white noise","size":112.5,"fill":"#808080ff"}]},{"name":"rock","size":4977.80621017871,"fill":"#808080ff","children":[{"name":"album rock","size":1947.662581128022,"fill":"#808080ff"},{"name":"alternative metal","size":2520.278690753691,"fill":"#808080ff","children":[{"name":"grunge","size":342.6928571428571,"fill":"#808080ff"},{"name":"industrial metal","size":790.3555555555555,"fill":"#808080ff","children":[{"name":"ebm","size":864.7992424242424,"fill":"#808080ff"}]},{"name":"melodic metalcore","size":835.3301587301587,"fill":"#808080ff"},{"name":"metalcore","size":763.2313492063493,"fill":"#808080ff"},{"name":"nu metal","size":1631.213539238539,"fill":"#808080ff"},{"name":"pop punk","size":488.9738095238095,"fill":"#808080ff","children":[{"name":"neon pop punk","size":155.0559523809524,"fill":"#808080ff"}]},{"name":"post-grunge","size":1210.344094794095,"fill":"#808080ff","children":[{"name":"pop rock","size":815.1739501239501,"fill":"#808080ff"}]}]},{"name":"alternative rock","size":1739.252560756237,"fill":"#808080ff","children":[{"name":"chamber pop","size":918.3865773115773,"fill":"#808080ff","children":[{"name":"indie folk","size":316.1529692529692,"fill":"#808080ff"}]},{"name":"electronica","size":955.2414904539904,"fill":"#808080ff","children":[{"name":"big beat","size":198.1321789321789,"fill":"#808080ff"},{"name":"breakbeat","size":131.0718253968254,"fill":"#808080ff"},{"name":"downtempo","size":634.3681027306027,"fill":"#808080ff"},{"name":"future garage","size":91.45543345543345,"fill":"#808080ff","children":[{"name":"classic dubstep","size":60.34166666666667,"fill":"#808080ff"}]},{"name":"intelligent dance music","size":262.0680014430014,"fill":"#808080ff"},{"name":"trip hop","size":706.1351583057466,"fill":"#808080ff"},{"name":"wonky","size":123.4977633477634,"fill":"#808080ff"}]},{"name":"noise pop","size":269.0578754578755,"fill":"#808080ff","children":[{"name":"neo-psychedelic","size":208.4114468864469,"fill":"#808080ff"}]}]},{"name":"britpop","size":1497.227380952381,"fill":"#808080ff"},{"name":"classic rock","size":2140.830474101062,"fill":"#808080ff","children":[{"name":"art rock","size":560.0080583632055,"fill":"#808080ff"},{"name":"blues rock","size":880.5271943742532,"fill":"#808080ff","children":[{"name":"blues","size":257.1146207550619,"fill":"#808080ff","children":[{"name":"traditional blues","size":100.996082512259,"fill":"#808080ff"}]},{"name":"british blues","size":404.4932321763204,"fill":"#808080ff"},{"name":"electric blues","size":408.0729180133592,"fill":"#808080ff"},{"name":"modern blues","size":395.2698384948385,"fill":"#808080ff"},{"name":"modern blues rock","size":561.3860532441415,"fill":"#808080ff"},{"name":"southern rock","size":211.8872132769192,"fill":"#808080ff"}]},{"name":"folk rock","size":630.6292542424895,"fill":"#808080ff"},{"name":"hollywood","size":90.53703975762799,"fill":"#808080ff"},{"name":"progressive rock","size":1929.016942371354,"fill":"#808080ff","children":[{"name":"jazz fusion","size":309.5222796596249,"fill":"#808080ff"}]},{"name":"psychedelic rock","size":438.5487373737374,"fill":"#808080ff","children":[{"name":"mpb","size":259.3799845141309,"fill":"#808080ff","children":[{"name":"bossa nova","size":169.3980981416957,"fill":"#808080ff"},{"name":"pagode","size":205.6671893147503,"fill":"#808080ff","children":[{"name":"sertanejo universitario","size":275.8928571428572,"fill":"#808080ff"}]},{"name":"samba","size":125.0305216802168,"fill":"#808080ff"}]}]},{"name":"rockabilly","size":465.6683372183372,"fill":"#808080ff"}]},{"name":"dance rock","size":588.5304806304806,"fill":"#808080ff"},{"name":"emo","size":211.4972582972583,"fill":"#808080ff"},{"name":"filmi","size":166.5030525030525,"fill":"#808080ff","children":[{"name":"modern bollywood","size":113.0372405372405,"fill":"#808080ff"}]},{"name":"filter house","size":124.4147546897547,"fill":"#808080ff"},{"name":"funk","size":304.3529442779443,"fill":"#808080ff","children":[{"name":"p funk","size":37.13784271284271,"fill":"#808080ff"},{"name":"post-disco","size":128.4631313131313,"fill":"#808080ff"}]},{"name":"glam rock","size":901.4730190561073,"fill":"#808080ff"},{"name":"hard rock","size":2829.357152161564,"fill":"#808080ff","children":[{"name":"glam metal","size":1352.294945740534,"fill":"#808080ff"}]},{"name":"mellow gold","size":1438.111237700208,"fill":"#808080ff"},{"name":"metal","size":2716.035591206179,"fill":"#808080ff","children":[{"name":"black metal","size":743.8095238095239,"fill":"#808080ff"},{"name":"death metal","size":891.3154761904761,"fill":"#808080ff","children":[{"name":"brutal death metal","size":299.5738095238095,"fill":"#808080ff"},{"name":"deathgrind","size":315.5404761904762,"fill":"#808080ff"}]},{"name":"german metal","size":1978.528715728716,"fill":"#808080ff","children":[{"name":"medieval rock","size":1939.833008658009,"fill":"#808080ff"},{"name":"neue deutsche harte","size":1737.051262626263,"fill":"#808080ff"}]},{"name":"groove metal","size":808.7210317460317,"fill":"#808080ff"},{"name":"melodic death metal","size":650.5801587301587,"fill":"#808080ff"},{"name":"power metal","size":2103.446572871573,"fill":"#808080ff","children":[{"name":"gothic metal","size":1246.329401154401,"fill":"#808080ff"},{"name":"hel","size":108.6445887445887,"fill":"#808080ff"}]},{"name":"progressive metal","size":1797.432142857143,"fill":"#808080ff"},{"name":"speed metal","size":1240.116017316017,"fill":"#808080ff"},{"name":"symphonic metal","size":1247.117929292929,"fill":"#808080ff","children":[{"name":"gothic symphonic metal","size":494.2000721500721,"fill":"#808080ff"}]},{"name":"thrash metal","size":811.7674963924964,"fill":"#808080ff"}]},{"name":"modern rock","size":1644.197052800141,"fill":"#808080ff","children":[{"name":"garage rock","size":546.6558584389467,"fill":"#808080ff"},{"name":"indie rock","size":692.5184125515008,"fill":"#808080ff","children":[{"name":"compositional ambient","size":329.9670634920635,"fill":"#808080ff","children":[{"name":"neo-classical","size":233.4666666666667,"fill":"#808080ff","children":[{"name":"background piano","size":158.5,"fill":"#808080ff"}]}]},{"name":"dance-punk","size":139.6246031746032,"fill":"#808080ff"},{"name":"new rave","size":196.3841991341991,"fill":"#808080ff"},{"name":"stomp and holler","size":238.0459817959818,"fill":"#808080ff"}]},{"name":"indietronica","size":749.886486552663,"fill":"#808080ff","children":[{"name":"alternative dance","size":273.6706894412777,"fill":"#808080ff"},{"name":"indie soul","size":275.4807432763315,"fill":"#808080ff"},{"name":"neo-synthpop","size":288.3176230632113,"fill":"#808080ff"},{"name":"shimmer pop","size":149.5161949161949,"fill":"#808080ff"}]},{"name":"modern alternative rock","size":342.5416594516594,"fill":"#808080ff"},{"name":"pov: indie","size":217.2500360750361,"fill":"#808080ff"}]},{"name":"new wave pop","size":2541.333373978962,"fill":"#808080ff","children":[{"name":"australian dance","size":150.8220014462661,"fill":"#808080ff"},{"name":"british soul","size":648.2118829699712,"fill":"#808080ff"},{"name":"eurodance","size":1241.055032467533,"fill":"#808080ff","children":[{"name":"diva house","size":169.3163059163059,"fill":"#808080ff"},{"name":"hands up","size":157.2242424242424,"fill":"#808080ff"},{"name":"hip house","size":300.2476551226551,"fill":"#808080ff"}]},{"name":"new romantic","size":1578.535532523033,"fill":"#808080ff"},{"name":"new wave","size":1147.311387223887,"fill":"#808080ff"},{"name":"solo wave","size":537.8380341880342,"fill":"#808080ff"},{"name":"sophisti-pop","size":624.2479076479076,"fill":"#808080ff"},{"name":"synthpop","size":1312.787262737263,"fill":"#808080ff"}]},{"name":"permanent wave","size":2340.956914735591,"fill":"#808080ff","children":[{"name":"power pop","size":252.8062271062271,"fill":"#808080ff","children":[{"name":"underground power pop","size":54.26666666666667,"fill":"#808080ff"}]}]},{"name":"pop","size":4264.329168798415,"fill":"#808080ff","children":[{"name":"alt z","size":196.5189976689977,"fill":"#808080ff"},{"name":"anime","size":315.75,"fill":"#808080ff","children":[{"name":"j-pop","size":217.9761904761905,"fill":"#808080ff"},{"name":"j-rock","size":199.9166666666667,"fill":"#808080ff"}]},{"name":"boy band","size":999.7104367854367,"fill":"#808080ff"},{"name":"canadian contemporary r&b","size":61.04269798828622,"fill":"#808080ff"},{"name":"canadian pop","size":685.4823089878818,"fill":"#808080ff","children":[{"name":"chanson","size":542.0107142857142,"fill":"#808080ff","children":[{"name":"french pop","size":219.45,"fill":"#808080ff"}]}]},{"name":"candy pop","size":266.9903243815008,"fill":"#808080ff"},{"name":"dance pop","size":2231.32841842257,"fill":"#808080ff","children":[{"name":"australian pop","size":285.607215007215,"fill":"#808080ff"},{"name":"europop","size":1476.157671957672,"fill":"#808080ff","children":[{"name":"italo disco","size":392.4928571428571,"fill":"#808080ff"},{"name":"swedish pop","size":350.7350001305884,"fill":"#808080ff","children":[{"name":"classic swedish pop","size":273.7373015873016,"fill":"#808080ff"},{"name":"swedish electropop","size":56.34176460794108,"fill":"#808080ff"}]}]},{"name":"girl group","size":339.574488011988,"fill":"#808080ff"},{"name":"hip pop","size":309.7160010528604,"fill":"#808080ff"},{"name":"latin pop","size":495.9760770388052,"fill":"#808080ff","children":[{"name":"colombian pop","size":72.28872573786367,"fill":"#808080ff"},{"name":"mexican pop","size":345.9177750410509,"fill":"#808080ff","children":[{"name":"latin arena pop","size":98.22337164750958,"fill":"#808080ff"}]},{"name":"musica mexicana","size":58.57063492063492,"fill":"#808080ff","children":[{"name":"norteno","size":45,"fill":"#808080ff"}]},{"name":"salsa","size":156.0000360750361,"fill":"#808080ff"},{"name":"spanish pop","size":63.06226053639847,"fill":"#808080ff"},{"name":"tropical","size":106.8417027417027,"fill":"#808080ff"},{"name":"urbano latino","size":172.0740480717507,"fill":"#808080ff","children":[{"name":"latin hip hop","size":87.68625516048789,"fill":"#808080ff"},{"name":"reggaeton colombiano","size":22.80445257919903,"fill":"#808080ff"},{"name":"trap latino","size":122.9435111640963,"fill":"#808080ff"}]}]},{"name":"neo mellow","size":1033.148974119562,"fill":"#808080ff","children":[{"name":"acoustic pop","size":126.094733044733,"fill":"#808080ff"}]},{"name":"r&b","size":899.920423101541,"fill":"#808080ff","children":[{"name":"afrofuturism","size":102.1493750530515,"fill":"#808080ff"},{"name":"alternative r&b","size":163.7308198939004,"fill":"#808080ff"},{"name":"contemporary r&b","size":322.5922102136378,"fill":"#808080ff"},{"name":"neo soul","size":555.4569081907085,"fill":"#808080ff"},{"name":"new jack swing","size":120.0847222639089,"fill":"#808080ff"},{"name":"uk contemporary r&b","size":71.81071428571428,"fill":"#808080ff"}]},{"name":"urban contemporary","size":686.9196509376884,"fill":"#808080ff"}]},{"name":"dancehall","size":218.6396383690269,"fill":"#808080ff"},{"name":"edm","size":356.0357208866777,"fill":"#808080ff","children":[{"name":"brostep","size":94.78269950150755,"fill":"#808080ff","children":[{"name":"filthstep","size":90.3752886002886,"fill":"#808080ff"}]},{"name":"canadian electronic","size":35.89687016200174,"fill":"#808080ff"},{"name":"complextro","size":84.14084567393391,"fill":"#808080ff"},{"name":"dutch house","size":86.83024508314756,"fill":"#808080ff"},{"name":"dutch trance","size":44.73328774195647,"fill":"#808080ff"},{"name":"electro house","size":180.5434162214348,"fill":"#808080ff"},{"name":"house","size":140.9598114805158,"fill":"#808080ff"},{"name":"progressive electro house","size":140.7722585335201,"fill":"#808080ff"},{"name":"progressive house","size":122.0343058042748,"fill":"#808080ff"}]},{"name":"electropop","size":267.3680558004087,"fill":"#808080ff"},{"name":"german techno","size":1217.408218170718,"fill":"#808080ff","children":[{"name":"bubble trance","size":531.2805916305916,"fill":"#808080ff"},{"name":"deep euro house","size":235.3945526695527,"fill":"#808080ff"},{"name":"german dance","size":312.4915584415584,"fill":"#808080ff"},{"name":"minimal techno","size":292.575,"fill":"#808080ff","children":[{"name":"acid house","size":61.34209956709957,"fill":"#808080ff"},{"name":"deep disco house","size":45.76190476190476,"fill":"#808080ff"},{"name":"microhouse","size":71.02857142857142,"fill":"#808080ff"},{"name":"minimal tech house","size":45.69404761904762,"fill":"#808080ff"},{"name":"techno","size":117.2496031746032,"fill":"#808080ff"}]},{"name":"trance","size":319.2339875108838,"fill":"#808080ff","children":[{"name":"uplifting trance","size":84.59265913824737,"fill":"#808080ff"}]}]},{"name":"gospel","size":275.8462560386474,"fill":"#808080ff"},{"name":"hip hop","size":1374.264878183866,"fill":"#808080ff","children":[{"name":"alternative hip hop","size":178.9307805326768,"fill":"#808080ff"},{"name":"conscious hip hop","size":219.8841242883886,"fill":"#808080ff"},{"name":"detroit hip hop","size":171.0271094679966,"fill":"#808080ff"},{"name":"dirty south rap","size":118.6598777204852,"fill":"#808080ff","children":[{"name":"crunk","size":16.70157079332776,"fill":"#808080ff"}]},{"name":"east coast hip hop","size":549.9472358161956,"fill":"#808080ff","children":[{"name":"battle rap","size":14.62550443622425,"fill":"#808080ff"},{"name":"bronx hip hop","size":26.43836649956585,"fill":"#808080ff"}]},{"name":"g funk","size":134.1849027495525,"fill":"#808080ff"},{"name":"gangster rap","size":421.05418705087,"fill":"#808080ff"},{"name":"golden age hip hop","size":119.4079567203709,"fill":"#808080ff"},{"name":"hardcore hip hop","size":294.4001425600702,"fill":"#808080ff"},{"name":"new jersey rap","size":56.45262595442128,"fill":"#808080ff"},{"name":"old school atlanta hip hop","size":45.70793998665316,"fill":"#808080ff"},{"name":"old school hip hop","size":104.075639971521,"fill":"#808080ff"},{"name":"philly rap","size":62.86967601112338,"fill":"#808080ff"},{"name":"queens hip hop","size":131.5603958081822,"fill":"#808080ff"},{"name":"trap soul","size":15.3244847962495,"fill":"#808080ff"},{"name":"west coast rap","size":242.8819034082169,"fill":"#808080ff"}]},{"name":"indie poptimism","size":79.15479797979798,"fill":"#808080ff"},{"name":"k-pop","size":368.1473304473304,"fill":"#808080ff"},{"name":"metropopolis","size":409.5950898774428,"fill":"#808080ff"},{"name":"miami hip hop","size":98.43917783798588,"fill":"#808080ff"},{"name":"pop dance","size":373.5349365345776,"fill":"#808080ff","children":[{"name":"big room","size":78.38303544862075,"fill":"#808080ff"},{"name":"classic hardstyle","size":143.8376845376845,"fill":"#808080ff","children":[{"name":"rawstyle","size":98.25440115440115,"fill":"#808080ff"}]},{"name":"deep house","size":120.2298701298701,"fill":"#808080ff","children":[{"name":"classic house","size":66.08611111111111,"fill":"#808080ff"},{"name":"disco house","size":51.14325396825397,"fill":"#808080ff"},{"name":"vocal house","size":33.54188034188034,"fill":"#808080ff"}]},{"name":"euphoric hardstyle","size":126.0364940614941,"fill":"#808080ff"},{"name":"melbourne bounce","size":19.45531612780065,"fill":"#808080ff"},{"name":"pop edm","size":32.818725207541,"fill":"#808080ff"},{"name":"slap house","size":112.1402487178571,"fill":"#808080ff","children":[{"name":"hypertechno","size":132.1512265512266,"fill":"#808080ff"}]},{"name":"tropical house","size":93.65752482811307,"fill":"#808080ff"},{"name":"uk dance","size":128.1880885024848,"fill":"#808080ff","children":[{"name":"drum and bass","size":197.4563852813853,"fill":"#808080ff","children":[{"name":"liquid funk","size":57.03333333333333,"fill":"#808080ff"}]}]}]},{"name":"pop r&b","size":37.60809190809191,"fill":"#808080ff"},{"name":"pop soul","size":279.3993043506201,"fill":"#808080ff"},{"name":"post-teen pop","size":325.9852480852481,"fill":"#808080ff"},{"name":"rap","size":1582.576436296152,"fill":"#808080ff","children":[{"name":"atl hip hop","size":319.1151461971953,"fill":"#808080ff"},{"name":"atl trap","size":29.09243917846859,"fill":"#808080ff"},{"name":"cali rap","size":23.95476041416444,"fill":"#808080ff"},{"name":"canadian hip hop","size":75.69558331675205,"fill":"#808080ff"},{"name":"chicago rap","size":127.8326096684533,"fill":"#808080ff"},{"name":"melodic rap","size":237.140804175185,"fill":"#808080ff"},{"name":"memphis hip hop","size":13.2960740240152,"fill":"#808080ff"},{"name":"new orleans rap","size":53.09720462028512,"fill":"#808080ff"},{"name":"pop rap","size":745.0768599462058,"fill":"#808080ff","children":[{"name":"grime","size":49.66706349206349,"fill":"#808080ff"}]},{"name":"southern hip hop","size":281.7357487302804,"fill":"#808080ff"},{"name":"trap","size":411.9497427367067,"fill":"#808080ff"},{"name":"trap queen","size":49.42038489288489,"fill":"#808080ff"},{"name":"underground hip hop","size":51.94165001665002,"fill":"#808080ff"}]},{"name":"reggaeton","size":190.2768759112165,"fill":"#808080ff"},{"name":"singer-songwriter pop","size":164.0853535353535,"fill":"#808080ff"},{"name":"uk pop","size":721.1450724112489,"fill":"#808080ff"},{"name":"viral pop","size":268.0468253968254,"fill":"#808080ff"}]},{"name":"punk","size":1243.346825396825,"fill":"#808080ff","children":[{"name":"ska","size":271.9833333333333,"fill":"#808080ff"},{"name":"skate punk","size":663.1777777777778,"fill":"#808080ff"}]},{"name":"singer-songwriter","size":1825.244504433475,"fill":"#808080ff","children":[{"name":"alternative country","size":230.6067173023055,"fill":"#808080ff"},{"name":"art pop","size":760.9778839409644,"fill":"#808080ff","children":[{"name":"indie pop","size":150.4162198912199,"fill":"#808080ff"}]},{"name":"country","size":320.9485975135975,"fill":"#808080ff","children":[{"name":"classic country pop","size":57.49381396381396,"fill":"#808080ff"},{"name":"contemporary country","size":224.7825541125541,"fill":"#808080ff","children":[{"name":"modern country rock","size":41.45519480519481,"fill":"#808080ff"}]},{"name":"country dawn","size":113.0939582639583,"fill":"#808080ff"},{"name":"country road","size":182.040101010101,"fill":"#808080ff"}]},{"name":"country rock","size":324.1289510815981,"fill":"#808080ff"},{"name":"ectofolk","size":280.6796398046398,"fill":"#808080ff"},{"name":"folk","size":633.5775073782427,"fill":"#808080ff","children":[{"name":"bluegrass","size":117.3782429988312,"fill":"#808080ff"},{"name":"progressive bluegrass","size":139.5672761878644,"fill":"#808080ff"}]},{"name":"heartland rock","size":550.5183959831019,"fill":"#808080ff"},{"name":"lilith","size":480.9676582132465,"fill":"#808080ff"},{"name":"melancholia","size":791.2890553890554,"fill":"#808080ff"},{"name":"movie tunes","size":236.0868215118215,"fill":"#808080ff","children":[{"name":"broadway","size":84.57176157176157,"fill":"#808080ff"},{"name":"show tunes","size":59.95168165168165,"fill":"#808080ff"}]},{"name":"new americana","size":102.7380341880342,"fill":"#808080ff"},{"name":"outlaw country","size":134.3775392581275,"fill":"#808080ff"},{"name":"piano rock","size":396.347551060051,"fill":"#808080ff"},{"name":"roots rock","size":343.9882993640347,"fill":"#808080ff"}]},{"name":"soft rock","size":2781.303690019131,"fill":"#808080ff","children":[{"name":"adult standards","size":484.8247585747586,"fill":"#808080ff","children":[{"name":"lounge","size":135.9087662337662,"fill":"#808080ff"},{"name":"rock-and-roll","size":311.7246503496503,"fill":"#808080ff"}]},{"name":"disco","size":465.9262737262737,"fill":"#808080ff"},{"name":"operatic pop","size":777.8077999185198,"fill":"#808080ff","children":[{"name":"canzone napoletana","size":15.00196963768945,"fill":"#808080ff"},{"name":"classical","size":301.9432211922924,"fill":"#808080ff","children":[{"name":"chamber orchestra","size":27.50793650793651,"fill":"#808080ff"},{"name":"classical cello","size":45.03102453102453,"fill":"#808080ff"},{"name":"classical performance","size":161.9343945227459,"fill":"#808080ff"},{"name":"classical piano","size":157.6063492063492,"fill":"#808080ff"},{"name":"early modern classical","size":51.34527417027417,"fill":"#808080ff"},{"name":"orchestra","size":104.4493324056404,"fill":"#808080ff","children":[{"name":"british orchestra","size":64.03869365928189,"fill":"#808080ff"},{"name":"german orchestra","size":21.23543298806457,"fill":"#808080ff"}]},{"name":"orchestral performance","size":51.8254544861743,"fill":"#808080ff"},{"name":"post-romantic era","size":54.48076069956875,"fill":"#808080ff"},{"name":"soundtrack","size":419.8254329004329,"fill":"#808080ff"},{"name":"violin","size":95.59194139194139,"fill":"#808080ff"}]},{"name":"classical tenor","size":191.2151238209675,"fill":"#808080ff"},{"name":"italian tenor","size":99.07108728474827,"fill":"#808080ff"},{"name":"opera","size":168.2502778997748,"fill":"#808080ff","children":[{"name":"classical soprano","size":52.87267069016295,"fill":"#808080ff"},{"name":"italian orchestra","size":25.52751039809863,"fill":"#808080ff"}]},{"name":"pop violin","size":227.4154761904762,"fill":"#808080ff","children":[{"name":"bow pop","size":273.0202380952381,"fill":"#808080ff"}]}]},{"name":"soul","size":441.5127615633421,"fill":"#808080ff","children":[{"name":"classic soul","size":71.22318237318237,"fill":"#808080ff"},{"name":"jazz funk","size":104.1645424020424,"fill":"#808080ff"},{"name":"motown","size":150.757196969697,"fill":"#808080ff"},{"name":"quiet storm","size":153.1391788766789,"fill":"#808080ff"},{"name":"southern soul","size":50.33738483738484,"fill":"#808080ff"}]},{"name":"vocal jazz","size":422.8088609876535,"fill":"#808080ff","children":[{"name":"contemporary vocal jazz","size":475.8901154401154,"fill":"#808080ff"},{"name":"jazz","size":196.561318042123,"fill":"#808080ff","children":[{"name":"bebop","size":88.02988934010605,"fill":"#808080ff"},{"name":"contemporary post-bop","size":116.8200844434204,"fill":"#808080ff"},{"name":"jazz piano","size":82.37914050603679,"fill":"#808080ff"},{"name":"jazz saxophone","size":123.2011781905745,"fill":"#808080ff"}]},{"name":"jazz pop","size":271.5020202020202,"fill":"#808080ff"},{"name":"jazz trumpet","size":214.658158710055,"fill":"#808080ff"}]},{"name":"yacht rock","size":344.7460561497326,"fill":"#808080ff"}]},{"name":"world","size":472.026862026862,"fill":"#808080ff","children":[{"name":"afropop","size":222.6219988344988,"fill":"#808080ff","children":[{"name":"afrobeats","size":47.74987373737373,"fill":"#808080ff"},{"name":"nigerian pop","size":33.59944083694084,"fill":"#808080ff"}]},{"name":"latin alternative","size":175.1190476190476,"fill":"#808080ff"}]}]}]},"margin_left":150,"margin_right":350,"margin_top":0,"margin_bottom":0,"min_font_size":22,"max_font_size":36},"type":"list","container":"svg","options":{"container":"div","viewer":null},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  N:/Materialien/Promotion/GenreDiscourseAnalysis/inst/d3/interactive_network_plot.js */\n// Interactive Network Plot - Fully responsive dimensions\nconst minNodeSpacing = 30; // Minimum spacing between nodes to prevent overlap\n\n// Get responsive width from container with timing-safe approach\nconst getResponsiveWidth = () => {\n    // Try multiple ways to get the container width\n    const svgNode = svg.node();\n    const computedStyle = window.getComputedStyle(svgNode);\n    if (computedStyle.width && computedStyle.width !== \"auto\") {\n        const width = parseFloat(computedStyle.width);\n        if (width > 0) {\n            return width - 4;\n        }\n    }\n\n    // Fallback to viewport width\n    console.log(\"Using viewport fallback width\");\n    return window.innerWidth * 0.8;\n};\n\n// Use responsive dimensions - prioritize container dimensions over r2d3 data\nconst actualHeight = (data.height || 1000) - 4; // Reduce by 4px for borders/padding\nconst actualWidth = getResponsiveWidth();\n\n// Calculate dynamic height based on tree structure\nfunction calculateRequiredHeight(root) {\n    const visibleNodes = root.descendants();\n    const nodesByDepth = {};\n\n    // Group nodes by depth level\n    visibleNodes.forEach(node => {\n        const depth = node.depth;\n        if (!nodesByDepth[depth]) {\n            nodesByDepth[depth] = [];\n        }\n        nodesByDepth[depth].push(node);\n    });\n\n    // Find the depth level with the most nodes\n    const maxNodesAtLevel = Math.max(...Object.values(nodesByDepth).map(nodes => nodes.length));\n\n    // Calculate required height: nodes * spacing (no margins needed with pan/zoom)\n    const requiredHeight = Math.max(\n        600, // Minimum height\n        maxNodesAtLevel * minNodeSpacing\n    );\n\n    return requiredHeight;\n}\n\n// Initialize with container height, will be recalculated for tree layout\nlet currentHeight = actualHeight;\n\n// Set up the SVG to exactly match the container (no manual sizing)\nsvg.attr(\"width\", actualWidth)\n    .attr(\"height\", actualHeight)\n    .style(\"background-color\", \"#fafafa\")\n    .style(\"overflow\", \"hidden\") // Remove scrollbars\n    .style(\"cursor\", \"grab\")\n    .style(\"display\", \"block\");\n\n// Add resize handler for responsive width\nwindow.addEventListener(\"resize\", function() {\n    const newWidth = getResponsiveWidth();\n    svg.attr(\"width\", newWidth);\n\n    // If there\"s tree content, we might want to recalculate layout\n    // For now, just update the SVG width - the pan/zoom will handle positioning\n});\n\n// Add zoom behavior\nconst zoom = d3.zoom()\n    .scaleExtent([0.1, 3]) // Zoom limits\n    .on(\"zoom\", (event) => {\n        container.attr(\"transform\", event.transform);\n        // Update cursor during pan\n        svg.style(\"cursor\", event.sourceEvent && event.sourceEvent.type === \"mousemove\" ? \"grabbing\" : \"grab\");\n    });\n\nsvg.call(zoom);\n\n// Create container for tree (this will be transformed by zoom/pan)\nconst container = svg.append(\"g\")\n    .attr(\"class\", \"tree-container\");\n\n// Add center button\nconst centerButton = svg.append(\"g\")\n    .attr(\"class\", \"center-button\")\n    .attr(\"transform\", \"translate(20, 20)\")\n    .style(\"cursor\", \"pointer\");\n\n// Button background\ncenterButton.append(\"rect\")\n    .attr(\"width\", 100)\n    .attr(\"height\", 30)\n    .attr(\"rx\", 5)\n    .style(\"fill\", \"#007acc\")\n    .style(\"stroke\", \"#005a9e\")\n    .style(\"stroke-width\", 1);\n\n// Button text\ncenterButton.append(\"text\")\n    .attr(\"x\", 50)\n    .attr(\"y\", 20)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"dy\", \"0em\")\n    .style(\"fill\", \"white\")\n    .style(\"font-size\", \"12px\")\n    .style(\"font-weight\", \"bold\")\n    .style(\"pointer-events\", \"none\")\n    .text(\"Center root\");\n\n// Button click handler\ncenterButton.on(\"click\", function() {\n    centerOnRoot();\n});\n\n// Add \"Expand All\" button\nconst expandAllButton = svg.append(\"g\")\n    .attr(\"class\", \"expand-all-button\")\n    .attr(\"transform\", \"translate(20, 60)\") // Position below center button\n    .style(\"cursor\", \"pointer\");\n\n// Expand All button background\nexpandAllButton.append(\"rect\")\n    .attr(\"width\", 100)\n    .attr(\"height\", 30)\n    .attr(\"rx\", 5)\n    .style(\"fill\", \"#28a745\")\n    .style(\"stroke\", \"#1e7e34\")\n    .style(\"stroke-width\", 1);\n\n// Expand All button text\nexpandAllButton.append(\"text\")\n    .attr(\"x\", 50)\n    .attr(\"y\", 20)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"dy\", \"0em\")\n    .style(\"fill\", \"white\")\n    .style(\"font-size\", \"12px\")\n    .style(\"font-weight\", \"bold\")\n    .style(\"pointer-events\", \"none\")\n    .text(\"Expand All\");\n\n// Expand All button click handler\nexpandAllButton.on(\"click\", function() {\n    expandAll();\n});\n\n// Add \"Fold All\" button\nconst foldAllButton = svg.append(\"g\")\n    .attr(\"class\", \"fold-all-button\")\n    .attr(\"transform\", \"translate(20, 100)\") // Position below expand button\n    .style(\"cursor\", \"pointer\");\n\n// Fold All button background\nfoldAllButton.append(\"rect\")\n    .attr(\"width\", 100)\n    .attr(\"height\", 30)\n    .attr(\"rx\", 5)\n    .style(\"fill\", \"#dc3545\")\n    .style(\"stroke\", \"#c82333\")\n    .style(\"stroke-width\", 1);\n\n// Fold All button text\nfoldAllButton.append(\"text\")\n    .attr(\"x\", 50)\n    .attr(\"y\", 20)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"dy\", \"0em\")\n    .style(\"fill\", \"white\")\n    .style(\"font-size\", \"12px\")\n    .style(\"font-weight\", \"bold\")\n    .style(\"pointer-events\", \"none\")\n    .text(\"Fold All\");\n\n// Fold All button click handler\nfoldAllButton.on(\"click\", function() {\n    foldAll();\n});\n\n// Function to center the view on the root node\nfunction centerOnRoot() {\n    if (!hierarchyRoot) return;\n\n    // Find the actual root node position after tree layout\n    const rootNode = hierarchyRoot;\n    const rootX = rootNode.x || 0;\n    const rootY = rootNode.y || 0;\n\n    // Calculate transform to center the root in the actual viewport\n    const centerX = actualWidth / 2;\n    const centerY = actualHeight / 2; // Center in actual viewport\n\n    const transform = d3.zoomIdentity\n        .translate(centerX - rootY, centerY - rootX) // Note: x and y are swapped in horizontal tree\n        .scale(1); // Reset zoom to 1x\n\n    // Animate to center\n    svg.transition()\n        .duration(750)\n        .call(zoom.transform, transform);\n} // Copy data and create persistent hierarchy\nlet currentData = JSON.parse(JSON.stringify(data.tree));\nlet hierarchyRoot = null; // Keep the hierarchy root persistent\nlet isFirstRender = true; // Track if this is the first render\n\n// Collapse function for raw data (not used anymore but keeping for reference)\nfunction collapseToFirstLevel(node, depth = 0) {\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n    if (node.children) {\n        node.children.forEach(child => collapseToFirstLevel(child, depth + 1));\n    }\n}\n\n// Collapse function for D3 hierarchy nodes (the one we actually use)\nfunction collapseHierarchyToFirstLevel(node, depth = 0) {\n\n    if (depth >= 1 && node.children) {\n        node._children = node.children;\n        node.children = null;\n    }\n\n    // Continue recursively for visible children\n    if (node.children) {\n        node.children.forEach(child => collapseHierarchyToFirstLevel(child, depth + 1));\n    }\n\n    // Also process hidden children to ensure deep collapse\n    if (node._children) {\n        node._children.forEach(child => collapseHierarchyToFirstLevel(child, depth + 1));\n    }\n}\n\n// Sort children by accumulated size (largest first)\nfunction sortChildrenBySize(node) {\n    // Sort visible children\n    if (node.children) {\n        node.children.sort((a, b) => calculateTotalSize(b) - calculateTotalSize(a));\n        // Recursively sort their children too\n        node.children.forEach(child => sortChildrenBySize(child));\n    }\n\n    // Sort hidden children (so they\"re in the right order when expanded)\n    if (node._children) {\n        node._children.sort((a, b) => calculateTotalSize(b) - calculateTotalSize(a));\n        // Recursively sort their children too\n        node._children.forEach(child => sortChildrenBySize(child));\n    }\n}\n\n// Find a node in the hierarchy by name\nfunction findNodeByName(root, name) {\n    if (root.data.name === name) {\n        return root;\n    }\n    if (root.children) {\n        for (let child of root.children) {\n            const found = findNodeByName(child, name);\n            if (found) return found;\n        }\n    }\n    if (root._children) {\n        for (let child of root._children) {\n            const found = findNodeByName(child, name);\n            if (found) return found;\n        }\n    }\n    return null;\n}\n\n// Check if a node has expandable children in persistent hierarchy\nfunction hasExpandableChildren(nodeName) {\n    if (!nodeName || !hierarchyRoot) {\n        console.warn(\"hasExpandableChildren: Invalid parameters\", {\n            nodeName,\n            hierarchyRoot: !!hierarchyRoot\n        });\n        return false;\n    }\n    const persistentNode = findNodeByName(hierarchyRoot, nodeName);\n    return persistentNode && (persistentNode.children || persistentNode._children);\n}\n\n// Check if a node is collapsed in persistent hierarchy\nfunction isCollapsed(nodeName) {\n    if (!nodeName || !hierarchyRoot) {\n        console.warn(\"isCollapsed: Invalid parameters\", {\n            nodeName,\n            hierarchyRoot: !!hierarchyRoot\n        });\n        return false;\n    }\n    const persistentNode = findNodeByName(hierarchyRoot, nodeName);\n    return persistentNode && persistentNode._children && !persistentNode.children;\n}\n\n// Calculate the total size of a node including all its descendants\nfunction calculateTotalSize(node) {\n    let totalSize = node.data.size || 0;\n\n    // Add sizes from visible children\n    if (node.children) {\n        for (let child of node.children) {\n            totalSize += calculateTotalSize(child);\n        }\n    }\n\n    // Add sizes from hidden children (collapsed nodes)\n    if (node._children) {\n        for (let child of node._children) {\n            totalSize += calculateTotalSize(child);\n        }\n    }\n\n    return totalSize;\n}\n\n// Get the effective size for display (aggregated size for collapsed nodes)\nfunction getEffectiveSize(displayNode, nodeName) {\n    const persistentNode = findNodeByName(hierarchyRoot, nodeName);\n\n    if (persistentNode && isCollapsed(nodeName)) {\n        // For collapsed nodes, return the total aggregated size\n        return calculateTotalSize(persistentNode);\n    } else {\n        // For expanded nodes or leaf nodes, return their own size\n        return displayNode.data.size || 0;\n    }\n}\n\n// Toggle function\nfunction toggle(d) {\n    // Safety check for data structure\n    if (!d.data) {\n        console.error(\"Node data is undefined, skipping toggle\");\n        return;\n    }\n    // Find the corresponding node in our persistent hierarchy\n    const persistentNode = findNodeByName(hierarchyRoot, d.data.name);\n    if (!persistentNode) {\n        console.error(\"Could not find node in persistent hierarchy:\", d.data.name);\n        return;\n    }\n\n    if (persistentNode.children) {\n        persistentNode._children = persistentNode.children;\n        persistentNode.children = null;\n    } else if (persistentNode._children) {\n        persistentNode.children = persistentNode._children;\n        persistentNode._children = null;\n    }\n\n    // Re-sort the entire hierarchy to maintain size-based ordering\n    sortChildrenBySize(hierarchyRoot);\n\n    update();\n}\n\n// Expand All function\nfunction expandAll() {\n    if (!hierarchyRoot) return;\n\n    // Recursively expand all nodes\n    function expandAllNodes(node) {\n        if (node._children) {\n            node.children = node._children;\n            node._children = null;\n        }\n        if (node.children) {\n            node.children.forEach(child => expandAllNodes(child));\n        }\n    }\n\n    expandAllNodes(hierarchyRoot);\n    sortChildrenBySize(hierarchyRoot);\n    update();\n\n    // Center on root and zoom out 30%\n    setTimeout(() => {\n        if (!hierarchyRoot) return;\n\n        const rootNode = hierarchyRoot;\n        const rootX = rootNode.x || 0;\n        const rootY = rootNode.y || 0;\n\n        const centerX = actualWidth / 2;\n        const centerY = actualHeight / 2;\n\n        const transform = d3.zoomIdentity\n            .translate(centerX - rootY, centerY - rootX)\n            .scale(0.7); // Zoom out 30% (100% - 30% = 70%)\n\n        svg.transition()\n            .duration(750)\n            .call(zoom.transform, transform);\n    }, 100); // Small delay to let the tree update first\n}\n\n// Fold All function\nfunction foldAll() {\n    if (!hierarchyRoot) return;\n\n    // Collapse everything to root only (no children visible)\n    function collapseToRoot(node) {\n        if (node.children) {\n            node._children = node.children;\n            node.children = null;\n        }\n        if (node._children) {\n            node._children.forEach(child => collapseToRoot(child));\n        }\n    }\n\n    collapseToRoot(hierarchyRoot);\n    sortChildrenBySize(hierarchyRoot);\n    update();\n\n    // Center on root with normal zoom (same as center button)\n    setTimeout(() => {\n        centerOnRoot();\n    }, 100); // Small delay to let the tree update first\n}\n\n// Update function\nfunction update() {\n    // Clear previous content (but keep the center button)\n    container.selectAll(\"*\").remove();\n\n    // Create or use existing hierarchy\n    if (isFirstRender) {\n        hierarchyRoot = d3.hierarchy(currentData);\n        collapseHierarchyToFirstLevel(hierarchyRoot, 0);\n        // Sort all nodes by accumulated size after initial setup\n        sortChildrenBySize(hierarchyRoot);\n        isFirstRender = false;\n    }\n\n    const root = hierarchyRoot;\n\n    // Calculate required height dynamically for tree layout\n    currentHeight = calculateRequiredHeight(root);\n\n    // Set up tree layout with full available space (no margins)\n    const treeLayout = d3.tree().size([currentHeight, actualWidth]);\n    treeLayout(root);\n\n    // Position the tree centered in the actual viewport\n    const startX = 0; // No left margin needed\n    const startY = actualHeight / 2; // Center in actual viewport\n\n    // Adjust all node positions\n    root.descendants().forEach(d => {\n        d.x = d.x - currentHeight / 2 + startY; // Center in actual viewport\n        d.y = d.y + startX; // Start from left edge\n    });\n\n    // Scale for node sizes - now considering aggregated sizes for collapsed nodes\n    const allEffectiveSizes = root.descendants().map(d => getEffectiveSize(d, d.data.name));\n    const sizeScale = d3.scaleLinear()\n        .domain([0, d3.max(allEffectiveSizes) || 1])\n        .range([4, 15]);\n\n    // Create links\n    const links = container.selectAll(\".link\")\n        .data(root.links())\n        .enter()\n        .append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", d3.linkHorizontal()\n            .x(d => d.y)\n            .y(d => d.x))\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", \"#ccc\")\n        .style(\"stroke-width\", 2);\n\n    // Create node groups\n    const nodes = container.selectAll(\".node\")\n        .data(root.descendants())\n        .enter()\n        .append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", d => `translate(${d.y}, ${d.x})`)\n        .style(\"cursor\", d => (d.data && hasExpandableChildren(d.data.name)) ? \"pointer\" : \"default\");\n\n    // Add circles\n    nodes.append(\"circle\")\n        .attr(\"r\", d => sizeScale(getEffectiveSize(d, d.data.name)))\n        .style(\"fill\", d => d.data.fill || \"#69b3a2\")\n        .style(\"stroke\", d => (d.data && hasExpandableChildren(d.data.name)) ? \"#000\" : \"none\")\n        .style(\"stroke-width\", d => (d.data && hasExpandableChildren(d.data.name)) ? 2 : 1)\n        .on(\"click\", function(event, d) {\n            // Prevent zoom behavior when clicking on nodes\n            event.stopPropagation();\n\n            // Check persistent hierarchy instead of display node\n            const persistentNode = findNodeByName(hierarchyRoot, d.data.name);\n            if (persistentNode) {\n                if (persistentNode._children || persistentNode.children) {\n                    toggle(d);\n                }\n            }\n        })\n        .on(\"mouseover\", function(event, d) {\n            if (d.data && hasExpandableChildren(d.data.name)) {\n                d3.select(this).style(\"stroke-width\", 4);\n            }\n        })\n        .on(\"mouseout\", function(event, d) {\n            d3.select(this).style(\"stroke-width\", (d.data && hasExpandableChildren(d.data.name)) ? 2 : 1);\n        });\n\n    // Add +/- indicators\n    nodes.filter(d => d.data && hasExpandableChildren(d.data.name))\n        .append(\"text\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"dy\", 4)\n        .style(\"font-size\", \"10px\")\n        .style(\"font-weight\", \"bold\")\n        .style(\"fill\", \"white\")\n        .style(\"pointer-events\", \"none\")\n        .text(d => isCollapsed(d.data.name) ? \"+\" : \"−\");\n\n    // Add labels\n    nodes.append(\"text\")\n        .attr(\"dy\", 3)\n        .attr(\"x\", d => hasExpandableChildren(d.data.name) ? -18 : 18)\n        .style(\"text-anchor\", d => hasExpandableChildren(d.data.name) ? \"end\" : \"start\")\n        .style(\"font-size\", \"12pt\")\n        .style(\"font-weight\", d => hasExpandableChildren(d.data.name) ? \"bold\" : \"normal\")\n        .style(\"text-decoration\", d => hasExpandableChildren(d.data.name) ? \"underline\" : \"none\")\n        .style(\"fill\", d => {\n            if (hasExpandableChildren(d.data.name)) return \"#0066cc\"; // Expandable nodes = blue\n            return \"#333\"; // Leaf nodes = dark gray\n        })\n        .style(\"cursor\", d => hasExpandableChildren(d.data.name) ? \"pointer\" : \"default\")\n        .text(d => d.data.name)\n        .on(\"click\", function(event, d) {\n            // Prevent zoom behavior when clicking on text\n            event.stopPropagation();\n\n            // Check persistent hierarchy instead of display node\n            const persistentNode = findNodeByName(hierarchyRoot, d.data.name);\n            if (persistentNode) {\n                if (persistentNode._children || persistentNode.children) {\n                    toggle(d);\n                }\n            }\n        })\n        .on(\"mouseover\", function(event, d) {\n            if (hasExpandableChildren(d.data.name)) {\n                d3.select(this).style(\"fill\", \"#0044aa\");\n            }\n        })\n        .on(\"mouseout\", function(event, d) {\n            d3.select(this).style(\"fill\", hasExpandableChildren(d.data.name) ? \"#0066cc\" : \"#333\");\n        });\n\n    // Add tooltips\n    nodes.append(\"title\")\n        .text(d => {\n            const effectiveSize = getEffectiveSize(d, d.data.name);\n            const originalSize = d.data.size || 0;\n\n            if (hasExpandableChildren(d.data.name)) {\n                const action = isCollapsed(d.data.name) ? \"expand\" : \"collapse\";\n                if (isCollapsed(d.data.name) && effectiveSize > originalSize) {\n                    return `${d.data.name} (Click to ${action}) - Aggregated size: ${effectiveSize} (own: ${originalSize})`;\n                } else {\n                    return `${d.data.name} (Click to ${action}) - Size: ${effectiveSize}`;\n                }\n            }\n            return `${d.data.name} - Size: ${effectiveSize}`;\n        });\n}\n\n// Initial render\nupdate();\n\n// Center on root after initial render\nsetTimeout(() => {\n    centerOnRoot();\n}, 100); // Small delay to ensure rendering is complete\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>